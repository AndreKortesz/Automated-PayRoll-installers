# Salary Service - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

## üìã –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –∑–∞—Ä–ø–ª–∞—Ç—ã –º–æ–Ω—Ç–∞–∂–Ω–∏–∫–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ Excel-–æ—Ç—á—ë—Ç–æ–≤ –∏–∑ 1–°.

**–°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π:**
- Backend: FastAPI (Python 3.11)
- Database: PostgreSQL (Railway)
- Frontend: HTML/JS/CSS (Jinja2 templates)
- Deployment: Railway

**URL:** https://automated-payroll-installers-production.up.railway.app

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
/backend/
  app.py          - –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª FastAPI (~2850 —Å—Ç—Ä–æ–∫)
  database.py     - –ú–æ–¥–µ–ª–∏ –ë–î –∏ —Ñ—É–Ω–∫—Ü–∏–∏ (~650 —Å—Ç—Ä–æ–∫)
  requirements.txt

/frontend/templates/
  index.html      - –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (–∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤)
  history.html    - –°–ø–∏—Å–æ–∫ –ø–µ—Ä–∏–æ–¥–æ–≤
  period.html     - –î–µ—Ç–∞–ª–∏ –ø–µ—Ä–∏–æ–¥–∞ (—Å–ø–∏—Å–æ–∫ —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤)
  upload.html     - –î–µ—Ç–∞–ª–∏ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞ (—Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤)
  comparison.html - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π
```

---

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã

#### 1. `periods` - –ü–µ—Ä–∏–æ–¥—ã —Ä–∞—Å—á—ë—Ç–∞
```sql
id              SERIAL PRIMARY KEY
name            VARCHAR(50)   -- "01-15.11.25", "16-30.11.25"
month           VARCHAR(7)    -- "2025-11"
year            INTEGER       -- 2025
created_at      TIMESTAMP
```

#### 2. `uploads` - –í–µ—Ä—Å–∏–∏ –∑–∞–≥—Ä—É–∑–æ–∫
```sql
id              SERIAL PRIMARY KEY
period_id       INTEGER REFERENCES periods(id)
version         INTEGER       -- 1, 2, 3... –Ω–æ–º–µ—Ä –≤–µ—Ä—Å–∏–∏
created_at      TIMESTAMP
config_json     JSON          -- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å—á—ë—Ç–∞
```

#### 3. `orders` - –ó–∞–∫–∞–∑—ã (–∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
```sql
id                  SERIAL PRIMARY KEY
upload_id           INTEGER REFERENCES uploads(id)
worker              VARCHAR(100)  -- "–í–µ—Ç—Ä–µ–Ω–∫–æ –î–º–∏—Ç—Ä–∏–π" –∏–ª–∏ "–í–µ—Ç—Ä–µ–Ω–∫–æ –î–º–∏—Ç—Ä–∏–π (–æ–ø–ª–∞—Ç–∞ –∫–ª–∏–µ–Ω—Ç–æ–º)"
order_code          VARCHAR(50)   -- "–ö–ê–£–¢-001770"
order_full          TEXT          -- –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –∑–∞–∫–∞–∑–∞
address             TEXT          -- –ê–¥—Ä–µ—Å (–∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ order_full)
revenue_total       FLOAT         -- –í—ã—Ä—É—á–∫–∞ –∏—Ç–æ–≥–æ
revenue_services    FLOAT         -- –í—ã—Ä—É—á–∫–∞ –æ—Ç —É—Å–ª—É–≥
diagnostic          FLOAT         -- –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
diagnostic_payment  FLOAT         -- –û–ø–ª–∞—Ç–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
specialist_fee      FLOAT         -- –í—ã—Ä—É—á–∫–∞ (–≤—ã–µ–∑–¥)
additional_expenses FLOAT         -- –î–æ–ø. —Ä–∞—Å—Ö–æ–¥—ã
service_payment     FLOAT         -- –°—É–º–º–∞ –æ–ø–ª–∞—Ç—ã
percent             VARCHAR(20)   -- "30,00 %"
is_client_payment   BOOLEAN       -- TRUE –µ—Å–ª–∏ –æ–ø–ª–∞—Ç–∞ –∫–ª–∏–µ–Ω—Ç–æ–º (–í–ê–ñ–ù–û!)
is_over_10k         BOOLEAN       -- TRUE –µ—Å–ª–∏ –≤—ã—Ä—É—á–∫–∞ > 10–∫
is_extra_row        BOOLEAN       -- TRUE –µ—Å–ª–∏ —Ä—É—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ
```

#### 4. `calculations` - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á—ë—Ç–æ–≤
```sql
id              SERIAL PRIMARY KEY
upload_id       INTEGER REFERENCES uploads(id)
order_id        INTEGER REFERENCES orders(id)
worker          VARCHAR(100)
fuel_payment    FLOAT         -- –û–ø–ª–∞—Ç–∞ –±–µ–Ω–∑–∏–Ω–∞
transport       FLOAT         -- –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ (1000‚ÇΩ)
diagnostic_50   FLOAT         -- –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ -50%
total           FLOAT         -- –ò–¢–û–ì–û = service_payment + fuel + transport
```

#### 5. `worker_totals` - –ò—Ç–æ–≥–∏ –ø–æ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞–º
```sql
id                  SERIAL PRIMARY KEY
upload_id           INTEGER REFERENCES uploads(id)
worker              VARCHAR(100)  -- –ë–∞–∑–æ–≤–æ–µ –∏–º—è –ë–ï–ó "(–æ–ø–ª–∞—Ç–∞ –∫–ª–∏–µ–Ω—Ç–æ–º)"
total_amount        FLOAT         -- company_amount + client_amount
company_amount      FLOAT         -- –°—É–º–º–∞ –∑–∞–∫–∞–∑–æ–≤ is_client_payment=FALSE
client_amount       FLOAT         -- –°—É–º–º–∞ –∑–∞–∫–∞–∑–æ–≤ is_client_payment=TRUE
orders_count        INTEGER
company_orders_count INTEGER
client_orders_count  INTEGER
fuel_total          FLOAT
transport_total     FLOAT
```

#### 6. `changes` - –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –º–µ–∂–¥—É –≤–µ—Ä—Å–∏—è–º–∏
```sql
id              SERIAL PRIMARY KEY
upload_id       INTEGER REFERENCES uploads(id)
order_code      VARCHAR(50)
worker          VARCHAR(100)
change_type     VARCHAR(20)   -- "added", "modified", "deleted"
field_name      VARCHAR(50)
old_value       TEXT
new_value       TEXT
created_at      TIMESTAMP
```

#### 7. `manual_edits` - –†—É—á–Ω—ã–µ –ø—Ä–∞–≤–∫–∏ –≤ UI
```sql
id              SERIAL PRIMARY KEY
upload_id       INTEGER REFERENCES uploads(id)
order_id        INTEGER REFERENCES orders(id)
calculation_id  INTEGER REFERENCES calculations(id)
order_code      VARCHAR(50)
worker          VARCHAR(100)
address         TEXT
field_name      VARCHAR(50)   -- "fuel_payment", "transport", "total"
old_value       FLOAT
new_value       FLOAT
created_at      TIMESTAMP
```

---

## üî¢ –§–æ—Ä–º—É–ª—ã —Ä–∞—Å—á—ë—Ç–∞

### –û—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ –∏—Ç–æ–≥–æ
```
–ò–¢–û–ì–û = –°—É–º–º–∞_–æ–ø–ª–∞—Ç—ã + –ë–µ–Ω–∑–∏–Ω + –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ
```

### –ë–µ–Ω–∑–∏–Ω (fuel_payment)
**–£—Å–ª–æ–≤–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è:**
1. `specialist_fee == 0` (–≤—ã–µ–∑–¥ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ –Ω–µ –æ–ø–ª–∞—á–µ–Ω)
2. –ï—Å—Ç—å –∞–¥—Ä–µ—Å –≤ —Ç–µ–∫—Å—Ç–µ –∑–∞–∫–∞–∑–∞
3. –ê–¥—Ä–µ—Å –≤ –ú–æ—Å–∫–≤–µ –∏–ª–∏ –ú–æ—Å–∫–æ–≤—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏

**–§–æ—Ä–º—É–ª–∞:**
```
–ë–µ–Ω–∑–∏–Ω = min(—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ_–∫–º √ó 2 √ó –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç, –º–∞–∫—Å–∏–º—É–º)
```
- `–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç` = 7 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `–º–∞–∫—Å–∏–º—É–º` = 3000‚ÇΩ

### –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ (transport)
**–£—Å–ª–æ–≤–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è:**
1. `revenue_services > 10000` (–≤—ã—Ä—É—á–∫–∞ –æ—Ç —É—Å–ª—É–≥ > 10–∫)
2. `20% <= percent <= 40%` (–ø—Ä–æ—Ü–µ–Ω—Ç –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ)
3. –†–∞–±–æ—Ç–Ω–∏–∫ –ù–ï –Ω–∞ –º–∞—à–∏–Ω–µ –∫–æ–º–ø–∞–Ω–∏–∏

**–°—É–º–º–∞:** 1000‚ÇΩ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è)

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ -50% (diagnostic_50)
**–£—Å–ª–æ–≤–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è:**
1. `is_client_payment == TRUE` (—Å–µ–∫—Ü–∏—è "–æ–ø–ª–∞—Ç–∞ –∫–ª–∏–µ–Ω—Ç–æ–º")
2. `diagnostic > 0`

**–§–æ—Ä–º—É–ª–∞:**
```
diagnostic_50 = diagnostic √ó 50%
```

---

## üîÑ –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ—Å—á—ë—Ç–∞ worker_totals

### –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û!

–ü—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Å—á—ë—Ç** —á–µ—Ä–µ–∑ JOIN:

```sql
SELECT c.total, c.fuel_payment, c.transport, o.is_client_payment
FROM calculations c
JOIN orders o ON c.order_id = o.id
WHERE c.upload_id = :upload_id
AND (o.worker = :worker OR o.worker = :worker_client)
```

**–ó–∞—Ç–µ–º –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è:**
```python
company_amount = SUM(total) WHERE is_client_payment = FALSE
client_amount = SUM(total) WHERE is_client_payment = TRUE
total_amount = company_amount + client_amount
```

### –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ
- –ü–æ–ª–µ `is_client_payment` —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `orders`, –ù–ï –≤ –∏–º–µ–Ω–∏ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞
- –ù–µ–ª—å–∑—è –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ç–∏–ø –æ–ø–ª–∞—Ç—ã –ø–æ —Å—É—Ñ—Ñ–∏–∫—Å—É "(–æ–ø–ª–∞—Ç–∞ –∫–ª–∏–µ–Ω—Ç–æ–º)" –≤ –∏–º–µ–Ω–∏
- –í—Å–µ —Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ (add/update/delete) –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –ª–æ–≥–∏–∫—É

---

## üìä –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ (index.html ‚Üí app.py)

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç 2 Excel —Ñ–∞–π–ª–∞:
   - "–¥–æ 10–∫" (is_over_10k=FALSE)
   - "—Å–≤—ã—à–µ 10–∫" (is_over_10k=TRUE)

2. parse_both_excel_files():
   - –°–±–æ—Ä –≤—Å–µ—Ö –∏–º—ë–Ω —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤
   - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ (–∫–æ—Ä–æ—Ç–∫–æ–µ –∏–º—è ‚Üí –ø–æ–ª–Ω–æ–µ)
   - –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–æ–∫ –∏–∑ –æ–±–æ–∏—Ö —Ñ–∞–π–ª–æ–≤

3. calculate_data():
   - –î–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏: calculate_row()
   - –†–∞—Å—á—ë—Ç –±–µ–Ω–∑–∏–Ω–∞ (–≥–µ–æ–∫–æ–¥–∏–Ω–≥ –∞–¥—Ä–µ—Å–æ–≤)
   - –†–∞—Å—á—ë—Ç —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö
   - –†–∞—Å—á—ë—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ -50%
   - –ò—Ç–æ–≥–æ

4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î:
   - period ‚Üí upload ‚Üí orders ‚Üí calculations
   - –ê–≥—Ä–µ–≥–∞—Ü–∏—è worker_totals

5. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Excel –æ—Ç—á—ë—Ç–æ–≤
```

### 2. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ UI (upload.html ‚Üí app.py)

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ —è—á–µ–π–∫—É (–ë–µ–Ω–∑–∏–Ω/–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ/–ò—Ç–æ–≥–æ)
2. –í–≤–æ–¥–∏—Ç –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
3. –ù–∞–∂–∏–º–∞–µ—Ç "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è"
4. POST /api/calculation/{calc_id}/update
5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ calculations
6. –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Å—á—ë—Ç worker_totals —á–µ—Ä–µ–∑ JOIN
7. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ manual_edits (–∏—Å—Ç–æ—Ä–∏—è)
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ (upload.html ‚Üí app.py)

```
1. –ù–∞–∂–∞—Ç–∏–µ "‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É"
2. POST /api/upload/{id}/worker/{worker}/add-row
3. –°–æ–∑–¥–∞–Ω–∏–µ order —Å is_extra_row=TRUE
4. –°–æ–∑–¥–∞–Ω–∏–µ calculation
5. –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Å—á—ë—Ç worker_totals
```

### 4. –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ (upload.html ‚Üí app.py)

```
1. –ù–∞–∂–∞—Ç–∏–µ "‚úï" –Ω–∞ —Å—Ç—Ä–æ–∫–µ
2. DELETE /api/order/{order_id}
3. –£–¥–∞–ª–µ–Ω–∏–µ manual_edits (foreign key!)
4. –£–¥–∞–ª–µ–Ω–∏–µ calculation
5. –£–¥–∞–ª–µ–Ω–∏–µ order
6. –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Å—á—ë—Ç worker_totals
```

---

## üé® –°—Ç—Ä–∞–Ω–∏—Ü—ã UI

### index.html - –ì–ª–∞–≤–Ω–∞—è
- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–≤—É—Ö Excel —Ñ–∞–π–ª–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å—á—ë—Ç–∞ (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã)
- –í—ã–±–æ—Ä —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ –Ω–∞ –º–∞—à–∏–Ω–µ –∫–æ–º–ø–∞–Ω–∏–∏
- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–æ–≤

### history.html - –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–∏–æ–¥–æ–≤
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–µ—Ä–∏–æ–¥–æ–≤
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –º–µ—Å—è—Ü–∞–º
- –ü–µ—Ä–µ—Ö–æ–¥ –∫ –¥–µ—Ç–∞–ª—è–º –ø–µ—Ä–∏–æ–¥–∞

### period.html - –ü–µ—Ä–∏–æ–¥
- –¢–∞–±—ã —Å –≤–µ—Ä—Å–∏—è–º–∏ (–í–µ—Ä—Å–∏—è 1, 2, 3...)
- –ö–∞—Ä—Ç–æ—á–∫–∏ —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ —Å —Å—É–º–º–∞–º–∏
- company_amount (–∑–µ–ª—ë–Ω—ã–π) / client_amount (–æ—Ä–∞–Ω–∂–µ–≤—ã–π)
- –ö–Ω–æ–ø–∫–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –æ—Ç—á—ë—Ç–æ–≤
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π

### upload.html - –†–∞–±–æ—Ç–Ω–∏–∫
- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å —Å –∏—Ç–æ–≥–∞–º–∏
- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤
- –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–µ —è—á–µ–π–∫–∏ (–ë–µ–Ω–∑–∏–Ω, –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ, –ò—Ç–æ–≥–æ)
- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏
- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏

### comparison.html - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π
- –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã
- –ù–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã
- –£–¥–∞–ª—ë–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

```python
DEFAULT_CONFIG = {
    "base_address": "–ú–æ—Å–∫–≤–∞, –°—Ö–æ–¥–Ω–µ–Ω—Å–∫–∏–π —Ç—É–ø–∏–∫ 16—Å4",
    "fuel_coefficient": 7,
    "fuel_max": 3000,
    "fuel_warning": 2000,
    "transport_amount": 1000,
    "transport_min_revenue": 10000,
    "transport_percent_min": 20,
    "transport_percent_max": 40,
    "diagnostic_percent": 50,
    "alarm_high_payment": 20000,
    "alarm_high_specialist": 3500,
    "standard_percents": [30, 50, 100],
    "yandex_api_key": "..."
}
```

---

## üö® –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (Alarms)

–ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏:

1. **high_payment** - –°—É–º–º–∞ –æ–ø–ª–∞—Ç—ã > 20 000
2. **non_standard_percent** - –ü—Ä–æ—Ü–µ–Ω—Ç –Ω–µ 30/50/100
3. **high_specialist_fee** - –í—ã—Ä—É—á–∫–∞ (–≤—ã–µ–∑–¥) > 3 500
4. **high_fuel** - –û–ø–ª–∞—Ç–∞ –±–µ–Ω–∑–∏–Ω–∞ > 2 000

---

## üîå API Endpoints

### –ü–µ—Ä–∏–æ–¥—ã –∏ –∑–∞–≥—Ä—É–∑–∫–∏
- `GET /api/periods` - –°–ø–∏—Å–æ–∫ –ø–µ—Ä–∏–æ–¥–æ–≤
- `GET /api/period/{id}` - –î–µ—Ç–∞–ª–∏ –ø–µ—Ä–∏–æ–¥–∞
- `GET /api/upload/{id}` - –î–µ—Ç–∞–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∏
- `GET /api/upload/{id}/worker/{worker}` - –ó–∞–∫–∞–∑—ã —Ä–∞–±–æ—Ç–Ω–∏–∫–∞

### –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- `POST /api/calculation/{id}/update` - –û–±–Ω–æ–≤–∏—Ç—å —Ä–∞—Å—á—ë—Ç
- `PUT /api/order/{id}/update` - –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–∫–∞–∑
- `POST /api/upload/{id}/worker/{worker}/add-row` - –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É
- `DELETE /api/order/{id}` - –£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É

### –û—Ç—á—ë—Ç—ã
- `GET /api/period/{id}/download/full` - –ü–æ–ª–Ω—ã–π –æ—Ç—á—ë—Ç Excel
- `GET /api/period/{id}/download/workers` - –û—Ç—á—ë—Ç –¥–ª—è –º–æ–Ω—Ç–∞–∂–Ω–∏–∫–æ–≤
- `GET /api/period/{id}/download/archive` - ZIP –∞—Ä—Ö–∏–≤

### –°–ª—É–∂–µ–±–Ω—ã–µ
- `POST /api/upload/{id}/recalculate` - –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤—Å–µ worker_totals
- `GET /api/1c/status` - –°—Ç–∞—Ç—É—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å 1–°

---

## üîß –û—Å–æ–±—ã–µ —Å–ª—É—á–∞–∏

### –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏–º—ë–Ω —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤
–ï—Å–ª–∏ –≤ —Ñ–∞–π–ª–∞—Ö –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ–¥–Ω–æ–≥–æ –∏–º–µ–Ω–∏:
- "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω" ‚Üí "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á"

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç—Ä–æ–∏—Ç –∫–∞—Ä—Ç—É –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç.

### –ò—Å–∫–ª—é—á—ë–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã (–Ω–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∏)
```python
EXCLUDED_GROUPS = {
    "–¥–æ—Å—Ç–∞–≤–∫–∞", "–¥–æ—Å—Ç–∞–≤–∫–∞ –ª–µ—Å—Ç–Ω–∏—Ü—ã",
    "–æ—Å–º–æ—Ç—Ä –±–µ–∑ –æ–ø–ª–∞—Ç—ã", "–ø–æ–º–æ—â–Ω–∏–∫",
    "–∏—Ç–æ–≥–æ", "–ø–∞—Ä–∞–º–µ—Ç—Ä—ã:", "–º–æ–Ω—Ç–∞–∂–Ω–∏–∫"
}
```

### –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ú–æ—Å–∫–≤—ã/–ú–û
–ë–µ–Ω–∑–∏–Ω –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥—Ä–µ—Å–æ–≤ –≤ –ú–æ—Å–∫–≤–µ –∏ –ú–û.
–õ–æ–≥–∏–∫–∞: —Å—á–∏—Ç–∞–µ–º –∞–¥—Ä–µ—Å –º–æ—Å–∫–æ–≤—Å–∫–∏–º, –µ—Å–ª–∏ –ù–ï –Ω–∞–π–¥–µ–Ω—ã —è–≤–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã –¥—Ä—É–≥–∏—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤.

---

## ‚ùó –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–ì–µ–æ–∫–æ–¥–∏–Ω–≥** - Yandex API –∏–º–µ–µ—Ç –ª–∏–º–∏—Ç—ã, fallback –Ω–∞ Nominatim
2. **–§–æ—Ä–º—É–ª—ã Excel** - –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–Ω–µ —Ñ–æ—Ä–º—É–ª—ã) –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –ë–∏—Ç—Ä–∏–∫—Å
3. **Foreign keys** - –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª—è—Ç—å manual_edits ‚Üí calculations ‚Üí orders

---

## üìù –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –î–µ–∫–∞–±—Ä—å 2024
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è PostgreSQL
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ company/client amount
- –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–µ —è—á–µ–π–∫–∏ –≤ UI
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—Ä—Ö–∏–≤–æ–≤
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ—Å—á—ë—Ç–∞ worker_totals (–ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Å—á—ë—Ç —á–µ—Ä–µ–∑ JOIN)
- –ó–∞–º–µ–Ω–∞ —Ñ–æ—Ä–º—É–ª Excel –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏—è

---

## üöÄ –î–µ–ø–ª–æ–π

Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç –ø—Ä–∏ push –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
- `DATABASE_URL` - PostgreSQL connection string

**–ü–æ—Ä—Ç:** 8000
