# üìö –ë–ê–ó–ê –ó–ù–ê–ù–ò–ô: Salary Service –¥–ª—è Mos-GSM

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞—Å—á—ë—Ç –∑–∞—Ä–ø–ª–∞—Ç—ã –º–æ–Ω—Ç–∞–∂–Ω–∏–∫–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ 1–°.

**–û—Å–Ω–æ–≤–Ω–æ–π workflow:**
1. –ë—É—Ö–≥–∞–ª—Ç–µ—Ä –≤—ã–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª—ã –∏–∑ 1–° (–¥–≤–∞ —Ñ–∞–π–ª–∞: –æ–±—ä–µ–∫—Ç—ã <10k –∏ >10k)
2. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤ —Å–∏—Å—Ç–µ–º—É
3. –°–∏—Å—Ç–µ–º–∞ –ø–∞—Ä—Å–∏—Ç –¥–∞–Ω–Ω—ã–µ, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –±–µ–Ω–∑–∏–Ω/—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
4. –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–µ–π
5. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
6. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç—á—ë—Ç—ã (–æ–±—â–∏–π + –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ)

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
- **Backend:** FastAPI (Python 3.12)
- **Database:** PostgreSQL (Railway)
- **Frontend:** HTML/JS (Jinja2 templates)
- **Hosting:** Railway

### –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
```
/home/claude/
‚îú‚îÄ‚îÄ app.py              # –û—Å–Ω–æ–≤–Ω–æ–π backend (~3800 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ database.py         # –ú–æ–¥–µ–ª–∏ –∏ —Ñ—É–Ω–∫—Ü–∏–∏ –ë–î (~664 —Å—Ç—Ä–æ–∫–∏)
‚îú‚îÄ‚îÄ templates_new/      # HTML —à–∞–±–ª–æ–Ω—ã (–∞–∫—Ç–∏–≤–Ω—ã–µ)
‚îÇ   ‚îú‚îÄ‚îÄ index.html      # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îú‚îÄ‚îÄ period.html     # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–µ—Ä–∏–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ upload.html     # –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∑–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ review.html     # –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–≤—å—é –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ history.html    # –ò—Å—Ç–æ—Ä–∏—è –≤–µ—Ä—Å–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ comparison.html # –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π
‚îî‚îÄ‚îÄ *.md                # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

---

## üìä –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã

#### `periods` ‚Äî –ü–µ—Ä–∏–æ–¥—ã —Ä–∞—Å—á—ë—Ç–∞
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | Integer PK | |
| name | String(50) | "16-30.11.25" |
| month | String(7) | "2025-11" |
| year | Integer | 2025 |

#### `uploads` ‚Äî –í–µ—Ä—Å–∏–∏ –∑–∞–≥—Ä—É–∑–æ–∫
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | Integer PK | |
| period_id | FK ‚Üí periods | |
| version | Integer | 1, 2, 3... |
| config_json | JSON | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å—á—ë—Ç–∞ |
| created_at | DateTime | |

#### `orders` ‚Äî –ó–∞–∫–∞–∑—ã (–∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ 1–°)
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | Integer PK | |
| upload_id | FK ‚Üí uploads | |
| worker | String(100) | –§–ò–û –º–æ–Ω—Ç–∞–∂–Ω–∏–∫–∞ |
| order_code | String(50) | "–ö–ê–£–¢-001736" |
| order_full | Text | –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –∑–∞–∫–∞–∑–∞ |
| address | Text | –ê–¥—Ä–µ—Å –æ–±—ä–µ–∫—Ç–∞ |
| revenue_total | Float | –í—ã—Ä—É—á–∫–∞ –∏—Ç–æ–≥–æ |
| revenue_services | Float | –í—ã—Ä—É—á–∫–∞ –æ—Ç —É—Å–ª—É–≥ |
| diagnostic | Float | –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ |
| diagnostic_payment | Float | –û–ø–ª–∞—Ç–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ |
| specialist_fee | Float | –í—ã–µ–∑–¥ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ |
| additional_expenses | Float | –î–æ–ø. —Ä–∞—Å—Ö–æ–¥—ã |
| service_payment | Float | –û–ø–ª–∞—Ç–∞ —É—Å–ª—É–≥ |
| percent | String(20) | "30,00 %" |
| is_client_payment | Boolean | –û–ø–ª–∞—Ç–∞ –∫–ª–∏–µ–Ω—Ç–æ–º |
| is_over_10k | Boolean | –û–±—ä–µ–∫—Ç >10k |
| is_extra_row | Boolean | –†—É—á–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ |

#### `calculations` ‚Äî –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á—ë—Ç–æ–≤
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| id | Integer PK | |
| upload_id | FK ‚Üí uploads | |
| order_id | FK ‚Üí orders | |
| worker | String(100) | |
| fuel_payment | Float | –û–ø–ª–∞—Ç–∞ –±–µ–Ω–∑–∏–Ω–∞ |
| transport | Float | –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ |
| diagnostic_50 | Float | –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ -50% |
| total | Float | –ò—Ç–æ–≥–æ –∫ –≤—ã–ø–ª–∞—Ç–µ |

#### `worker_totals` ‚Äî –ò—Ç–æ–≥–∏ –ø–æ –º–æ–Ω—Ç–∞–∂–Ω–∏–∫–∞–º
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| upload_id | FK | |
| worker | String | |
| total_amount | Float | –û–±—â–∞—è —Å—É–º–º–∞ |
| company_amount | Float | –û–ø–ª–∞—Ç–∞ –∫–æ–º–ø–∞–Ω–∏–µ–π |
| client_amount | Float | –û–ø–ª–∞—Ç–∞ –∫–ª–∏–µ–Ω—Ç–æ–º |
| orders_count | Integer | –ö–æ–ª-–≤–æ –∑–∞–∫–∞–∑–æ–≤ |

#### `manual_edits` ‚Äî –†—É—á–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| upload_id | FK | |
| order_id | FK | |
| field_name | String | fuel_payment/transport/total |
| old_value | Float | |
| new_value | Float | |

---

## üîÑ –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã

### 1. –ü–∞—Ä—Å–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤ 1–°

**–§—É–Ω–∫—Ü–∏—è:** `parse_1c_file(file, file_type)`

–§–∞–π–ª—ã 1–° –∏–º–µ—é—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
- –ó–∞–≥–æ–ª–æ–≤–∫–∏: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã, –ü–µ—Ä–∏–æ–¥, –ü—Ä–æ—Ü–µ–Ω—Ç
- –î–∞–Ω–Ω—ã–µ: —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –º–æ–Ω—Ç–∞–∂–Ω–∏–∫–∞–º
- –°–µ–∫—Ü–∏–∏: "–í–µ—Ç—Ä–µ–Ω–∫–æ –î–º–∏—Ç—Ä–∏–π" –∏ "–í–µ—Ç—Ä–µ–Ω–∫–æ –î–º–∏—Ç—Ä–∏–π (–æ–ø–ª–∞—Ç–∞ –∫–ª–∏–µ–Ω—Ç–æ–º)"

**–ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è –∏–∑ 1–°:**
```python
{
    "worker": "–í–µ—Ç—Ä–µ–Ω–∫–æ –î–º–∏—Ç—Ä–∏–π",
    "order": "–ó–∞–∫–∞–∑ –∫–ª–∏–µ–Ω—Ç–∞ –ö–ê–£–¢-001736 –æ—Ç 21.11.2025, —É–ª. –û—Å—Ç–æ–∂–µ–Ω–∫–∞ 10",
    "revenue_total": 27065.0,        # –í—ã—Ä—É—á–∫–∞ –∏—Ç–æ–≥–æ
    "revenue_services": 15000.0,     # –í—ã—Ä—É—á–∫–∞ –æ—Ç —É—Å–ª—É–≥
    "diagnostic": 3000.0,            # –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
    "diagnostic_payment": 1500.0,    # –û–ø–ª–∞—Ç–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
    "specialist_fee": 5000.0,        # –í—ã–µ–∑–¥ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞
    "additional_expenses": 0.0,      # –î–æ–ø. —Ä–∞—Å—Ö–æ–¥—ã
    "service_payment": 7500.0,       # –û–ø–ª–∞—Ç–∞ —É—Å–ª—É–≥
    "percent": "30,00 %",            # –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –≤—ã—Ä—É—á–∫–∏
    "is_client_payment": False,      # –°–µ–∫—Ü–∏—è "–æ–ø–ª–∞—Ç–∞ –∫–ª–∏–µ–Ω—Ç–æ–º"
}
```

### 2. –†–∞—Å—á—ë—Ç –∑–∞—Ä–ø–ª–∞—Ç—ã

**–§—É–Ω–∫—Ü–∏—è:** `calculate_row(row, config, cache)`

–§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á—ë—Ç–∞:
```python
total = service_payment + fuel_payment + transport + diagnostic_50

–≥–¥–µ:
- service_payment = –∏–∑ 1–° (—É–∂–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ)
- fuel_payment = —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ –∞–¥—Ä–µ—Å—É (Yandex Geocoder ‚Üí —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ ‚Üí —Ç–∞—Ä–∏—Ñ)
- transport = –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ fuel
- diagnostic_50 = -50% –æ—Ç diagnostic (—Ç–æ–ª—å–∫–æ –¥–ª—è "–æ–ø–ª–∞—Ç–∞ –∫–ª–∏–µ–Ω—Ç–æ–º")
```

**–¢–∞—Ä–∏—Ñ—ã –±–µ–Ω–∑–∏–Ω–∞ (config):**
| –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ | –°—É–º–º–∞ |
|------------|-------|
| 0-10 –∫–º | 0 ‚ÇΩ |
| 10-15 –∫–º | 200 ‚ÇΩ |
| 15-20 –∫–º | 300 ‚ÇΩ |
| 20-30 –∫–º | 400 ‚ÇΩ |
| 30-40 –∫–º | 500 ‚ÇΩ |
| 40-60 –∫–º | 600-900 ‚ÇΩ |
| >100 –∫–º | 1700 ‚ÇΩ |

### 3. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π

**–§—É–Ω–∫—Ü–∏—è:** `compare_changes()` (–≤ `/upload` endpoint)

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ —Å–∏—Å—Ç–µ–º–∞ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π **–Ω–µ–ø—É—Å—Ç–æ–π** –≤–µ—Ä—Å–∏–µ–π:

```python
# –ù–∞—Ö–æ–¥–∏–º –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é —Å –∑–∞–∫–∞–∑–∞–º–∏
for upload in uploads:
    orders = await get_orders_by_upload(upload["id"])
    if orders and len(orders) > 0:
        old_orders = orders
        break
```

**–¢–∏–ø—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
1. **Added** ‚Äî –Ω–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã (–µ—Å—Ç—å –≤ —Ñ–∞–π–ª–µ, –Ω–µ—Ç –≤ –ë–î)
2. **Deleted** ‚Äî —É–¥–∞–ª—ë–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã (–µ—Å—Ç—å –≤ –ë–î, –Ω–µ—Ç –≤ —Ñ–∞–π–ª–µ)
3. **Modified** ‚Äî –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (revenue_total, percent –∏ —Ç.–¥.)
4. **Extra rows** ‚Äî —Ä—É—á–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ (–û—Ç–ø—É—Å–∫–Ω—ã–µ, –î–û–ü–õ–ê–¢–ê, –ü–µ—Ä–µ–ø–ª–∞—Ç–∞)

### 4. –†–µ–≤—å—é –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–°—Ç—Ä–∞–Ω–∏—Ü–∞:** `/review?session_id=...`
**API:** `GET /api/review/{session_id}`

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç:
- ‚ûï –ù–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –ø—Ä–∏–Ω—è—Ç—å)
- ‚ûñ –£–¥–∞–ª—ë–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: —É–¥–∞–ª–∏—Ç—å, –º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å)
- ‚úèÔ∏è –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å)

### 5. Extra Rows (–†—É—á–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏)

**–¢–∏–ø—ã:**
- –û—Ç–ø—É—Å–∫–Ω—ã–µ
- –î–û–ü–õ–ê–¢–ê
- –ü–µ—Ä–µ–ø–ª–∞—Ç–∞ –ü—Ä–µ—á–∏—Å—Ç–µ–Ω–∫–∞ (–ü—Ä–æ—à–ª—ã–π —Ä–∞—Å—á–µ—Ç)
- –†–µ–º–æ–Ω—Ç –∞–≤—Ç–æ (–ö–∞—Ä–¥–∞–Ω)
- –∏ –¥—Ä—É–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ù–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –∏–∑ 1–°
- –î–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ UI
- –ü—Ä–∏ –Ω–æ–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ "–£–¥–∞–ª—ë–Ω–Ω—ã–µ"
- –ú–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å—É–º–º

**–•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î:**
```python
orders.is_extra_row = True
orders.order_code = ""  # –ü—É—Å—Ç–æ–π!
orders.order_full = "–û—Ç–ø—É—Å–∫–Ω—ã–µ"  # –ù–∞–∑–≤–∞–Ω–∏–µ –∑–¥–µ—Å—å
calculations.total = 39493  # –°—É–º–º–∞
```

### 6. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤

**–§—É–Ω–∫—Ü–∏–∏:**
- `create_excel_report()` ‚Äî –æ–±—â–∏–π –æ—Ç—á—ë—Ç
- `create_individual_report()` ‚Äî –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –¥–ª—è –º–æ–Ω—Ç–∞–∂–Ω–∏–∫–∞
- `create_archive()` ‚Äî ZIP —Å–æ –≤—Å–µ–º–∏ —Ñ–∞–π–ª–∞–º–∏

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ Excel:**
```
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
–ü–µ—Ä–∏–æ–¥: 16-30.11.25
–ü—Ä–æ—Ü–µ–Ω—Ç –æ–ø–ª–∞—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏: 50%

–ú–æ–Ω—Ç–∞–∂–Ω–∏–∫ | ... | –í—ã—Ä—É—á–∫–∞ –∏—Ç–æ–≥–æ | ... | –ë–µ–Ω–∑–∏–Ω | –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç | –ò—Ç–æ–≥–æ
-----------------------------------------------------------------
–í–µ—Ç—Ä–µ–Ω–∫–æ –î–º–∏—Ç—Ä–∏–π
  –ó–∞–∫–∞–∑ –ö–ê–£–¢-001736... | 27065 | ... | 300 | - | 7800
  –ó–∞–∫–∞–∑ –ö–ê–£–¢-001756... | 15000 | ... | - | - | 3500
  
–í–µ—Ç—Ä–µ–Ω–∫–æ –î–º–∏—Ç—Ä–∏–π (–æ–ø–ª–∞—Ç–∞ –∫–ª–∏–µ–Ω—Ç–æ–º)
  –ó–∞–∫–∞–∑ –ö–ê–£–¢-001763... | 5000 | ... | - | - | 2500
```

---

## üîß –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏–º—ë–Ω
```python
def normalize_worker_name(name, name_map={}):
    """
    –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –∏–º—è —Ä–∞–±–æ—Ç–Ω–∏–∫–∞.
    "–û–ø–∞—Ä–∏–Ω–æ–≤ –ü–∞–≤–µ–ª" ‚Üí "–û–ø–∞—Ä–∏–Ω–æ–≤ –ü–∞–≤–µ–ª –ò–≥–æ—Ä–µ–≤–∏—á"
    """
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–º—ë–Ω
```python
def is_valid_worker_name(name):
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ —ç—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–µ –§–ò–û, –∞ –Ω–µ —Å–ª—É–∂–µ–±–Ω–æ–µ —Å–ª–æ–≤–æ.
    "–í–µ—Ç—Ä–µ–Ω–∫–æ –î–º–∏—Ç—Ä–∏–π" ‚Üí True
    "–î–æ—Å—Ç–∞–≤–∫–∞" ‚Üí False
    "–ü–æ–º–æ—â–Ω–∏–∫" ‚Üí False
    """
```

### –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ —á–∏—Å–µ–ª
```python
def safe_float_db(val):
    """
    –ü–∞—Ä—Å–∏—Ç —á–∏—Å–ª–∞ –∏–∑ –ë–î (–º–æ–≥—É—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∏ —Ç–∏–ø–∞ '30,00 %')
    '30,00 %' ‚Üí 30.0
    1500 ‚Üí 1500.0
    None ‚Üí 0.0
    """
```

### –ì–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
async def geocode_address(address, cache):
    """
    Yandex Geocoder API ‚Üí –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã ‚Üí —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –æ—Ç —Ü–µ–Ω—Ç—Ä–∞ –ú–æ—Å–∫–≤—ã
    """
```

---

## üö® –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### 1. –ü—É—Å—Ç—ã–µ –≤–µ—Ä—Å–∏–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö —Å–æ–∑–¥–∞—é—Ç—Å—è –≤–µ—Ä—Å–∏–∏ —Å 0 –∑–∞–∫–∞–∑–æ–≤
**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–∏—Å–∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π –Ω–µ–ø—É—Å—Ç–æ–π –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏

### 2. Extra rows –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è
**–ü—Ä–æ–±–ª–µ–º–∞:** order_code –ø—É—Å—Ç–æ–π, –Ω–∞–∑–≤–∞–Ω–∏–µ –≤ order_full
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `order_full` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

### 3. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ extra rows
**–ü—Ä–æ–±–ª–µ–º–∞:** Extra rows –¥–æ–±–∞–≤–ª—è–ª–∏—Å—å –¥–≤–∞–∂–¥—ã –≤ deleted
**–†–µ—à–µ–Ω–∏–µ:** –£–±—Ä–∞–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ

### 4. is_client_payment –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–æ–≤–µ—Ä—è–ª–æ—Å—å —Ç–æ–ª—å–∫–æ –∏–º—è worker, –∞ –Ω–µ –ø–æ–ª–µ –∑–∞–ø–∏—Å–∏
**–†–µ—à–µ–Ω–∏–µ:** `is_client = row.get("is_client_payment", False) or "(–æ–ø–ª–∞—Ç–∞ –∫–ª–∏–µ–Ω—Ç–æ–º)" in worker`

### 5. uploads[0] –±–µ—Ä—ë—Ç –ø—É—Å—Ç—É—é –≤–µ—Ä—Å–∏—é
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–¥ –±—Ä–∞–ª –ø–µ—Ä–≤—É—é –≤–µ—Ä—Å–∏—é, –∫–æ—Ç–æ—Ä–∞—è –º–æ–≥–ª–∞ –±—ã—Ç—å –ø—É—Å—Ç–æ–π
**–†–µ—à–µ–Ω–∏–µ:** –¶–∏–∫–ª –ø–æ –≤–µ—Ä—Å–∏—è–º —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–∫–∞–∑–æ–≤

---

## üì° API Endpoints

### –û—Å–Ω–æ–≤–Ω—ã–µ
| –ú–µ—Ç–æ–¥ | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-----|----------|
| GET | / | –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ |
| GET | /period/{id} | –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–µ—Ä–∏–æ–¥–∞ |
| POST | /upload | –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ |
| GET | /review | –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–≤—å—é |
| POST | /api/apply-review | –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è |
| GET | /api/periods | –°–ø–∏—Å–æ–∫ –ø–µ—Ä–∏–æ–¥–æ–≤ |
| GET | /api/period/{id} | –î–µ—Ç–∞–ª–∏ –ø–µ—Ä–∏–æ–¥–∞ |
| GET | /api/upload/{id} | –î–µ—Ç–∞–ª–∏ –≤–µ—Ä—Å–∏–∏ |

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ
| –ú–µ—Ç–æ–¥ | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-----|----------|
| GET | /api/list-uploads/{period_id} | –°–ø–∏—Å–æ–∫ –≤–µ—Ä—Å–∏–π —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∑–∞–∫–∞–∑–æ–≤ |
| GET | /api/delete-upload/{upload_id} | –£–¥–∞–ª–∏—Ç—å –≤–µ—Ä—Å–∏—é |

### –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
| –ú–µ—Ç–æ–¥ | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-----|----------|
| POST | /api/add-extra-row | –î–æ–±–∞–≤–∏—Ç—å —Ä—É—á–Ω—É—é —Å—Ç—Ä–æ–∫—É |
| POST | /api/update-cell | –û–±–Ω–æ–≤–∏—Ç—å —è—á–µ–π–∫—É |

---

## üîê –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
DATABASE_URL=postgresql://user:pass@host:port/db
YANDEX_GEOCODER_API_KEY=your_key
```

---

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ö–ª—é—á–µ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª–æ–≥–∞—Ö:

```
üìä Found version 11 with 89 orders          # –ù–∞–π–¥–µ–Ω–∞ –≤–µ—Ä—Å–∏—è –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
üìä Comparison: 85 orders in DB              # –ó–∞–∫–∞–∑–æ–≤ –≤ –ë–î
üìä Comparison: 85 orders in new files       # –ó–∞–∫–∞–∑–æ–≤ –≤ –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–∞—Ö
üìä Comparison result: 1 added, 5 deleted, 0 modified
üìã Found extra row: –û—Ç–ø—É—Å–∫–Ω—ã–µ_–í–µ—Ç—Ä–µ–Ω–∫–æ –î–º–∏—Ç—Ä–∏–π total=39493
‚úÖ Restored: –û—Ç–ø—É—Å–∫–Ω—ã–µ_–í–µ—Ç—Ä–µ–Ω–∫–æ –î–º–∏—Ç—Ä–∏–π (extra_row=True, total=39493)
‚ö†Ô∏è Skipping empty version 12                # –ü—Ä–æ–ø—É—Å–∫ –ø—É—Å—Ç–æ–π –≤–µ—Ä—Å–∏–∏
‚õΩ –ë–µ–Ω–∑–∏–Ω: —É–ª. –û—Å—Ç–æ–∂–µ–Ω–∫–∞, 10 -> 16.8 –∫–º -> 300 —Ä—É–±
```

---

## üé® UI/UX –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –î–∏–∑–∞–π–Ω
- –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞: –æ—Ä–∞–Ω–∂–µ–≤—ã–π (#FF9800) ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Ü–≤–µ—Ç Mos-GSM
- –ö–∞—Ä—Ç–æ—á–∫–∏ –º–æ–Ω—Ç–∞–∂–Ω–∏–∫–æ–≤ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ö–û–ú–ü–ê–ù–ò–Ø/–ö–õ–ò–ï–ù–¢
- –ë–µ–π–¥–∂–∏ –¥–ª—è —Ä—É—á–Ω—ã—Ö –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–æ–∫

### Review —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- –ß–µ–∫–±–æ–∫—Å—ã –¥–ª—è –≤—ã–±–æ—Ä–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –¶–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è: –∑–µ–ª—ë–Ω—ã–π (–¥–æ–±–∞–≤–∏—Ç—å), –∫—Ä–∞—Å–Ω—ã–π (—É–¥–∞–ª–∏—Ç—å), –æ—Ä–∞–Ω–∂–µ–≤—ã–π (–∏–∑–º–µ–Ω–∏—Ç—å)
- –ö–Ω–æ–ø–∫–∏: "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≤—Å—ë" / "–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å"

---

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏–∏

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ö–µ–º—ã –ë–î ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –≤ `create_tables()`:
```python
await database.execute("""
    ALTER TABLE orders ADD COLUMN IF NOT EXISTS is_extra_row BOOLEAN DEFAULT FALSE
""")
```

---

## üì¶ –î–µ–ø–ª–æ–π

1. Commit –≤ GitHub
2. Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ø–ª–æ–∏—Ç
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤ Railway Dashboard

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2025-12-11*
