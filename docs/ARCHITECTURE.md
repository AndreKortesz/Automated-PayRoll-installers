# ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

## Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ
1. [ĞĞ±Ğ·Ğ¾Ñ€ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹](#Ğ¾Ğ±Ğ·Ğ¾Ñ€-Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹)
2. [ĞœĞ¾Ğ´ÑƒĞ»Ğ¸ Ğ¸ Ğ¸Ñ… Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ](#Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸-Ğ¸-Ğ¸Ñ…-Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ)
3. [ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…](#Ğ¿Ğ¾Ñ‚Ğ¾Ğº-Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)
4. [Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹](#Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ-Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ-Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹)
5. [Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸](#Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸-Ğ¼ĞµĞ¶Ğ´Ñƒ-Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸)
6. [ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ¸ ÑĞ¾Ğ³Ğ»Ğ°ÑˆĞµĞ½Ğ¸Ñ](#Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹-Ğ¸-ÑĞ¾Ğ³Ğ»Ğ°ÑˆĞµĞ½Ğ¸Ñ)

---

## ĞĞ±Ğ·Ğ¾Ñ€ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹

### Ğ¢Ğ¸Ğ¿ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ñ‹
**Monolithic Web Application** Ñ Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸ĞµĞ¼ Ğ½Ğ° ÑĞ»Ğ¾Ğ¸:
- Presentation Layer (Frontend + Templates)
- Application Layer (FastAPI Endpoints)
- Business Logic Layer (Services)
- Data Access Layer (Database)

### Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚ĞµĞº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PRESENTATION                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   Jinja2    â”‚  â”‚    CSS      â”‚  â”‚ JavaScript  â”‚      â”‚
â”‚  â”‚  Templates  â”‚  â”‚  (style.css)â”‚  â”‚(security.js)â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    APPLICATION                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              FastAPI (app.py)                    â”‚    â”‚
â”‚  â”‚  â€¢ HTTP Endpoints                                â”‚    â”‚
â”‚  â”‚  â€¢ Request/Response handling                     â”‚    â”‚
â”‚  â”‚  â€¢ Session management                            â”‚    â”‚
â”‚  â”‚  â€¢ File upload processing                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   BUSINESS LOGIC                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Excel   â”‚ â”‚  Calc    â”‚ â”‚ Geocodingâ”‚ â”‚  Fuel    â”‚   â”‚
â”‚  â”‚  Parser  â”‚ â”‚  Engine  â”‚ â”‚  Service â”‚ â”‚  Parser  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    DATA ACCESS                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           SQLAlchemy + databases                 â”‚    â”‚
â”‚  â”‚           (database.py)                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     DATABASE                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                PostgreSQL                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ĞœĞ¾Ğ´ÑƒĞ»Ğ¸ Ğ¸ Ğ¸Ñ… Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ

### ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸

| ĞœĞ¾Ğ´ÑƒĞ»ÑŒ | Ğ¤Ğ°Ğ¹Ğ» | LOC | ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ |
|--------|------|-----|-----------------|
| **Main App** | `app.py` | ~3800 | Endpoints, orchestration |
| **Database** | `database.py` | ~1200 | ORM, CRUD, migrations |
| **Auth** | `auth.py` | ~300 | OAuth2, sessions |
| **Permissions** | `permissions.py` | ~350 | RBAC, access control |
| **Excel Parser** | `services/excel_parser.py` | ~400 | Parsing 1C files |
| **Excel Report** | `services/excel_report.py` | ~500 | Report generation |
| **Calculation** | `services/calculation.py` | ~250 | Salary calculation |
| **Geocoding** | `services/geocoding.py` | ~300 | Address â†’ coordinates |
| **Fuel Parser** | `services/yandex_fuel_parser.py` | ~280 | Yandex fuel parsing |

### Ğ’ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»Ğ¸

| ĞœĞ¾Ğ´ÑƒĞ»ÑŒ | Ğ¤Ğ°Ğ¹Ğ» | ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ |
|--------|------|-----------------|
| **Config** | `config.py` | Constants, settings |
| **CSRF** | `csrf_middleware.py` | Security middleware |
| **API Status** | `api_status.py` | Period status API |
| **Helpers** | `utils/helpers.py` | Utility functions |
| **Workers** | `utils/workers.py` | Name normalization |

---

## ĞŸĞ¾Ñ‚Ğ¾Ğº Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### 1. Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚â”€â”€â”€â–ºâ”‚ Upload  â”‚â”€â”€â”€â–ºâ”‚ Parser  â”‚â”€â”€â”€â–ºâ”‚ Session â”‚
â”‚         â”‚    â”‚Endpoint â”‚    â”‚(detect) â”‚    â”‚ Storage â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                  â”‚
                                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Review  â”‚â—„â”€â”€â”€â”‚ Compare â”‚â—„â”€â”€â”€â”‚ Previousâ”‚â—„â”€â”€â”€â”‚   DB    â”‚
â”‚  Page   â”‚    â”‚ Logic   â”‚    â”‚ Upload  â”‚    â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Ğ Ğ°ÑÑ‡Ñ‘Ñ‚ Ğ·Ğ°Ñ€Ğ¿Ğ»Ğ°Ñ‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Apply  â”‚â”€â”€â”€â–ºâ”‚  Save   â”‚â”€â”€â”€â–ºâ”‚ Geocode â”‚â”€â”€â”€â–ºâ”‚Calculateâ”‚
â”‚ Changes â”‚    â”‚ Orders  â”‚    â”‚ Address â”‚    â”‚  Fuel   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                  â”‚
                                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Reports â”‚â—„â”€â”€â”€â”‚ Worker  â”‚â—„â”€â”€â”€â”‚  Save   â”‚â—„â”€â”€â”€â”‚Calculateâ”‚
â”‚ (Excel) â”‚    â”‚ Totals  â”‚    â”‚  Calc   â”‚    â”‚Transportâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Edit   â”‚â”€â”€â”€â–ºâ”‚ Check   â”‚â”€â”€â”€â–ºâ”‚ Update  â”‚â”€â”€â”€â–ºâ”‚ Recalc  â”‚
â”‚  Cell   â”‚    â”‚ Perms   â”‚    â”‚   DB    â”‚    â”‚ Totals  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                  â”‚
                                                  â–¼
                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â”‚  Audit  â”‚
                                            â”‚   Log   â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¼Ğ¾Ğ´ÑƒĞ»ĞµĞ¹

### app.py â€” Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:**
- HTTP endpoints (GET, POST)
- ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
- Orchestration Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸
- Ğ ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†

**ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸:**

```python
# Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²
async def upload_files(files: List[UploadFile])
    """
    1. ĞŸĞ°Ñ€ÑĞ¸Ñ‚ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ„Ğ°Ğ¹Ğ» Ñ‡ĞµÑ€ĞµĞ· detect_file_type()
    2. ĞĞ±ÑŠĞµĞ´Ğ¸Ğ½ÑĞµÑ‚ Ğ²Ñ‹Ñ€ÑƒÑ‡ĞºÑƒ Ğ¸ Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºÑƒ
    3. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ² session_data
    4. Ğ ĞµĞ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¸Ñ‚ Ğ½Ğ° /review
    """

# ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹
async def apply_review_changes(request: Request)
    """
    1. Ğ§Ğ¸Ñ‚Ğ°ĞµÑ‚ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ¸Ğ· session
    2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚/Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´ Ğ² Ğ‘Ğ”
    3. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ·Ğ°ĞºĞ°Ğ·Ñ‹ Ğ¸ Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚Ñ‹
    4. ĞŸĞµÑ€ĞµÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¸Ñ‚Ğ¾Ğ³Ğ¸
    """

# Ğ Ğ°ÑÑ‡Ñ‘Ñ‚ Ğ·Ğ°Ñ€Ğ¿Ğ»Ğ°Ñ‚
async def calculate_salaries(request: Request)
    """
    1. ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ·Ğ°ĞºĞ°Ğ·Ñ‹ Ğ¸Ğ· Ğ‘Ğ”
    2. Ğ“ĞµĞ¾ĞºĞ¾Ğ´Ğ¸Ñ€ÑƒĞµÑ‚ Ğ°Ğ´Ñ€ĞµÑĞ°
    3. Ğ Ğ°ÑÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ±ĞµĞ½Ğ·Ğ¸Ğ½/Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚
    4. Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚Ñ‹
    5. Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ñ‹
    """

# ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑÑ‡ĞµĞ¹ĞºĞ¸
async def update_calculation(calc_id: int, request: Request)
    """
    1. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ¿Ñ€Ğ°Ğ²Ğ° (check_edit_permission)
    2. ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ Ğ¿Ğ¾Ğ»Ğµ Ğ² Ğ‘Ğ”
    3. Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°ĞµÑ‚ Ğ² manual_edits
    4. ĞŸĞµÑ€ĞµÑÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ worker_totals
    5. Ğ›Ğ¾Ğ³Ğ¸Ñ€ÑƒĞµÑ‚ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ
    """

# ĞŸĞ¾Ğ¸ÑĞº
async def search_orders(q: str, limit: int)
    """
    1. ĞĞ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·ÑƒĞµÑ‚ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ (Ñ‘â†’Ğµ)
    2. Ğ˜Ñ‰ĞµÑ‚ Ğ¿Ğ¾ order_code, address, worker
    3. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ pg_trgm Ğ´Ğ»Ñ fuzzy search
    4. Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒĞµÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ğ²ĞµÑ€ÑĞ¸Ğ¸
    """
```

**Endpoints Ğ¿Ğ¾ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼:**

| ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ | Endpoints |
|-----------|-----------|
| Auth | `/auth/login`, `/auth/callback`, `/auth/logout` |
| Pages | `/`, `/history`, `/upload/{id}`, `/search` |
| Upload | `POST /upload`, `/review`, `/apply-review` |
| API Periods | `/api/periods`, `/api/period/{id}` |
| API Worker | `/api/upload/{id}/worker/{name}` |
| API Edit | `/api/calculation/{id}/update`, `/api/order/{id}/delete` |
| API Search | `/api/search` |
| Download | `/api/period/{id}/download/{type}` |

---

### database.py â€” Data Access Layer

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:**
- SQLAlchemy Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸
- CRUD Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
- ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸
- ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğº Ğ‘Ğ”

**Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹:**

```python
# ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ
periods       # Ğ Ğ°ÑÑ‡Ñ‘Ñ‚Ğ½Ñ‹Ğµ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ñ‹
uploads       # Ğ’ĞµÑ€ÑĞ¸Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¾Ğº
orders        # Ğ—Ğ°ĞºĞ°Ğ·Ñ‹ Ğ¸Ğ· 1Ğ¡
calculations  # Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚Ğ¾Ğ²
worker_totals # Ğ˜Ñ‚Ğ¾Ğ³Ğ¸ Ğ¿Ğ¾ Ğ¼Ğ¾Ğ½Ñ‚Ğ°Ğ¶Ğ½Ğ¸ĞºĞ°Ğ¼

# ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸
users         # ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹
manual_edits  # Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ñ€ÑƒÑ‡Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ°Ğ²Ğ¾Ğº
audit_log     # Ğ›Ğ¾Ğ³ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹

# Ğ¡Ğ»ÑƒĞ¶ĞµĞ±Ğ½Ñ‹Ğµ
geocode_cache # ĞšÑÑˆ Ğ³ĞµĞ¾ĞºĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
sent_messages # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
```

**ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸:**

```python
# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ/Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ğ°
async def get_or_create_period(name: str) -> int

# Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ·Ğ°ĞºĞ°Ğ·Ğ°
async def save_order(upload_id: int, order_data: dict) -> int

# Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ Ğ²ĞµÑ€ÑĞ¸Ğ¹
async def compare_uploads(new_upload_id: int, old_upload_id: int) -> dict

# ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¼Ğ¾Ğ½Ñ‚Ğ°Ğ¶Ğ½Ğ¸ĞºĞ°
async def get_worker_orders(upload_id: int, worker: str) -> dict
```

---

### services/excel_parser.py â€” ĞŸĞ°Ñ€ÑĞµÑ€ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² 1Ğ¡

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:**
- ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¸Ğ¿Ğ° Ñ„Ğ°Ğ¹Ğ»Ğ° (Ğ²Ñ‹Ñ€ÑƒÑ‡ĞºĞ°/Ğ´Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ°)
- Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸Ğ· Excel
- ĞĞ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

**ĞĞ»Ğ³Ğ¾Ñ€Ğ¸Ñ‚Ğ¼ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ñ‚Ğ¸Ğ¿Ğ°:**

```python
def detect_file_type(df: pd.DataFrame) -> str:
    """
    1. Ğ˜Ñ‰ĞµÑ‚ ÑÑ‚Ñ€Ğ¾ĞºÑƒ "ĞÑ‚Ğ±Ğ¾Ñ€" Ğ² Ğ¿ĞµÑ€Ğ²Ñ‹Ñ… 30 ÑÑ‚Ñ€Ğ¾ĞºĞ°Ñ…
    2. Ğ•ÑĞ»Ğ¸ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ "Ğ½Ğµ Ñ€Ğ°Ğ²Ğ½Ğ¾ Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ°" â†’ revenue
    3. Ğ•ÑĞ»Ğ¸ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ "Ñ€Ğ°Ğ²Ğ½Ğ¾ Ğ”Ğ¸Ğ°Ğ³Ğ½Ğ¾ÑÑ‚Ğ¸ĞºĞ°" â†’ diagnostic
    4. Ğ˜Ğ½Ğ°Ñ‡Ğµ â†’ Ğ¿Ğ¾ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ Ñ„Ğ°Ğ¹Ğ»Ğ°
    """
```

**Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´Ğ°:**

```python
def extract_period(df: pd.DataFrame) -> str:
    """
    Ğ˜Ñ‰ĞµÑ‚ Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½: "Ğ—Ğ°ĞºĞ°Ğ· XX-XX.MM.YY Ğ¾Ñ‚ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°Ğ³ĞµĞ½Ñ‚Ğ°"
    Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚: "16-30.11.25"
    """
```

**ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ ÑÑ‚Ñ€Ğ¾Ğº:**

```python
def parse_excel_rows(df: pd.DataFrame) -> List[dict]:
    """
    1. ĞĞ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ ÑÑ‚Ñ€Ğ¾ĞºÑƒ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²ĞºĞ¾Ğ²
    2. ĞœĞ°Ğ¿Ğ¿Ğ¸Ñ‚ ĞºĞ¾Ğ»Ğ¾Ğ½ĞºĞ¸ Ğ½Ğ° Ğ¿Ğ¾Ğ»Ñ
    3. Ğ˜Ñ‚ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¿Ğ¾ ÑÑ‚Ñ€Ğ¾ĞºĞ°Ğ¼
    4. Ğ˜Ğ·Ğ²Ğ»ĞµĞºĞ°ĞµÑ‚: worker, order, address, revenue, etc.
    """
```

---

### services/calculation.py â€” Ğ Ğ°ÑÑ‡Ñ‘Ñ‚ Ğ·Ğ°Ñ€Ğ¿Ğ»Ğ°Ñ‚

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:**
- Ğ Ğ°ÑÑ‡Ñ‘Ñ‚ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹ ÑƒÑĞ»ÑƒĞ³
- Ğ Ğ°ÑÑ‡Ñ‘Ñ‚ Ğ±ĞµĞ½Ğ·Ğ¸Ğ½Ğ°
- Ğ Ğ°ÑÑ‡Ñ‘Ñ‚ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚Ğ½Ñ‹Ñ…
- ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ¯Ğ½Ğ´ĞµĞºÑ Ğ—Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ¾Ğº

**Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ñ‹:**

```python
def calculate_service_payment(revenue: float, percent: str) -> float:
    """ĞĞ¿Ğ»Ğ°Ñ‚Ğ° ÑƒÑĞ»ÑƒĞ³ = Ğ’Ñ‹Ñ€ÑƒÑ‡ĞºĞ° Ã— (ĞŸÑ€Ğ¾Ñ†ĞµĞ½Ñ‚ / 100)"""
    pct = parse_percent(percent)  # "30%" â†’ 30
    return revenue * (pct / 100)

def calculate_fuel(distance_km: float) -> float:
    """Ğ‘ĞµĞ½Ğ·Ğ¸Ğ½ Ğ¿Ğ¾ Ñ‚Ğ°Ñ€Ğ¸Ñ„Ğ½Ğ¾Ğ¹ ÑĞµÑ‚ĞºĞµ"""
    FUEL_TARIFFS = [
        (10, 100), (20, 200), (30, 300), (40, 400),
        (50, 500), (60, 600), (80, 900), (100, 1200),
        (150, 1700), (200, 2200), (999, 3000)
    ]
    for max_dist, payment in FUEL_TARIFFS:
        if distance_km <= max_dist:
            return payment
    return 3000

def calculate_transport(revenue: float, percent: str, worker: str) -> float:
    """Ğ¢Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚Ğ½Ñ‹Ğµ 1000â‚½ Ğ¿Ñ€Ğ¸ ÑƒÑĞ»Ğ¾Ğ²Ğ¸ÑÑ…"""
    if revenue <= 10000:
        return 0
    pct = parse_percent(percent)
    if pct < 20 or pct > 40:
        return 0
    if worker in COMPANY_CAR_WORKERS:
        return 0
    return 1000
```

---

### services/geocoding.py â€” Ğ“ĞµĞ¾ĞºĞ¾Ğ´Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:**
- ĞŸÑ€ĞµĞ¾Ğ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ°Ğ´Ñ€ĞµÑĞ° Ğ² ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ‚Ñ‹
- Ğ Ğ°ÑÑ‡Ñ‘Ñ‚ Ñ€Ğ°ÑÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ´Ğ¾ Ğ¾Ñ„Ğ¸ÑĞ°
- ĞšÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ²

**ĞŸÑ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ñ‹:**

1. **Yandex Geocoder** (Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹)
   ```python
   async def geocode_address_yandex(address: str) -> tuple:
       """
       API: geocode-maps.yandex.ru
       Ğ›Ğ¸Ğ¼Ğ¸Ñ‚: 1000 req/day (free)
       """
   ```

2. **Nominatim** (fallback)
   ```python
   async def geocode_address_nominatim(address: str) -> tuple:
       """
       API: nominatim.openstreetmap.org
       Ğ›Ğ¸Ğ¼Ğ¸Ñ‚: 1 req/sec
       """
   ```

**Ğ Ğ°ÑÑ‡Ñ‘Ñ‚ Ñ€Ğ°ÑÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ:**

```python
OFFICE_COORDS = (55.8309, 37.4294)  # Ğ¡Ñ…Ğ¾Ğ´Ğ½ĞµĞ½ÑĞºĞ¸Ğ¹ Ñ‚ÑƒĞ¿Ğ¸Ğº 16Ñ4

def calculate_distance(coords: tuple) -> float:
    """Haversine formula Ğ´Ğ»Ñ Ñ€Ğ°ÑÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ² ĞºĞ¼"""
    lat1, lon1 = OFFICE_COORDS
    lat2, lon2 = coords
    # ... haversine calculation
    return distance_km
```

---

### services/excel_report.py â€” Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ğ¾Ğ²

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:**
- Ğ‘ÑƒÑ…Ğ³Ğ°Ğ»Ñ‚ĞµÑ€ÑĞºĞ¸Ğ¹ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚ (ÑĞ²Ğ¾Ğ´Ğ½Ñ‹Ğ¹)
- Ğ˜Ğ½Ğ´Ğ¸Ğ²Ğ¸Ğ´ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ñ‹ (Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ñ‚Ğ°Ğ¶Ğ½Ğ¸ĞºĞ¾Ğ²)
- Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Excel

**Ğ¢Ğ¸Ğ¿Ñ‹ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ğ¾Ğ²:**

```python
def generate_accounting_report(upload_id: int) -> BytesIO:
    """
    Ğ¡Ğ²Ğ¾Ğ´Ğ½Ñ‹Ğ¹ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚ Ğ´Ğ»Ñ Ğ±ÑƒÑ…Ğ³Ğ°Ğ»Ñ‚ĞµÑ€Ğ¸Ğ¸:
    - Ğ’ÑĞµ Ğ¼Ğ¾Ğ½Ñ‚Ğ°Ğ¶Ğ½Ğ¸ĞºĞ¸
    - Ğ’ÑĞµ Ğ·Ğ°ĞºĞ°Ğ·Ñ‹
    - Ğ˜Ñ‚Ğ¾Ğ³Ğ¸ Ğ¿Ğ¾ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼Ñƒ
    - ĞĞ±Ñ‰Ğ¸Ğ¹ Ğ¸Ñ‚Ğ¾Ğ³
    """

def generate_worker_report(upload_id: int, worker: str) -> BytesIO:
    """
    Ğ˜Ğ½Ğ´Ğ¸Ğ²Ğ¸Ğ´ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ñ‚Ğ°Ğ¶Ğ½Ğ¸ĞºĞ°:
    - Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ĞµĞ³Ğ¾ Ğ·Ğ°ĞºĞ°Ğ·Ñ‹
    - Ğ Ğ°Ğ·Ğ±Ğ¸Ğ²ĞºĞ° Ğ¿Ğ¾ Ñ‚Ğ¸Ğ¿Ğ°Ğ¼ (ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½Ğ¸Ñ/ĞºĞ»Ğ¸ĞµĞ½Ñ‚)
    - Ğ”ĞµÑ‚Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚Ğ°
    """

def generate_all_reports_archive(upload_id: int) -> BytesIO:
    """
    ZIP Ğ°Ñ€Ñ…Ğ¸Ğ² ÑĞ¾ Ğ²ÑĞµĞ¼Ğ¸ Ğ¾Ñ‚Ñ‡Ñ‘Ñ‚Ğ°Ğ¼Ğ¸:
    - accounting_report.xlsx
    - worker_reports/
        - Ğ˜Ğ²Ğ°Ğ½Ğ¾Ğ²_Ğ˜Ğ²Ğ°Ğ½.xlsx
        - ĞŸĞµÑ‚Ñ€Ğ¾Ğ²_ĞŸÑ‘Ñ‚Ñ€.xlsx
        - ...
    """
```

---

### services/yandex_fuel_parser.py â€” Ğ¯Ğ½Ğ´ĞµĞºÑ Ğ—Ğ°Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸

**ĞÑ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ:**
- ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³ Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ¯Ğ½Ğ´ĞµĞºÑ Ğ—Ğ°Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸
- Ğ˜Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ ÑÑƒĞ¼Ğ¼ Ğ¿Ğ¾ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸ĞºĞ°Ğ¼
- ĞĞ¾Ñ€Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¸Ğ¼Ñ‘Ğ½

**Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ñ„Ğ°Ğ¹Ğ»Ğ°:**

```
| Ğ¤Ğ˜Ğ | Ğ¡ÑƒĞ¼Ğ¼Ğ° |
|-----|-------|
| Ğ˜Ğ²Ğ°Ğ½Ğ¾Ğ² Ğ˜Ğ²Ğ°Ğ½ Ğ˜Ğ²Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‡ | 10000 |
| ĞŸĞµÑ‚Ñ€Ğ¾Ğ² ĞŸÑ‘Ñ‚Ñ€ ĞŸĞµÑ‚Ñ€Ğ¾Ğ²Ğ¸Ñ‡ | 8500 |
```

**ĞŸĞ°Ñ€ÑĞ¸Ğ½Ğ³:**

```python
def parse_yandex_fuel(file: BytesIO) -> dict:
    """
    Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚: {
        "Ğ˜Ğ²Ğ°Ğ½Ğ¾Ğ² Ğ˜Ğ²Ğ°Ğ½": 10000,
        "ĞŸĞµÑ‚Ñ€Ğ¾Ğ² ĞŸÑ‘Ñ‚Ñ€": 8500
    }
    """
```

---

## Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑĞ¼Ğ¸

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   app.py    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                   â”‚                   â”‚
           â–¼                   â–¼                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ database.py â”‚     â”‚   auth.py   â”‚     â”‚permissions  â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                  services/                   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚excel_parser â”‚ calculation â”‚    geocoding    â”‚
    â”‚             â”‚             â”‚                 â”‚
    â”‚excel_report â”‚ yandex_fuel â”‚                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   utils/    â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  helpers    â”‚
    â”‚  workers    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ĞŸĞ°Ñ‚Ñ‚ĞµÑ€Ğ½Ñ‹ Ğ¸ ÑĞ¾Ğ³Ğ»Ğ°ÑˆĞµĞ½Ğ¸Ñ

### Naming Conventions

```python
# Functions: snake_case
async def get_worker_orders()
def calculate_fuel_cost()

# Classes: PascalCase
class PeriodStatus(Enum)

# Constants: UPPER_SNAKE_CASE
FUEL_TARIFFS = [...]
OFFICE_COORDS = (...)
DEFAULT_CONFIG = {...}

# Variables: snake_case
upload_id = 123
worker_name = "Ğ˜Ğ²Ğ°Ğ½Ğ¾Ğ²"
```

### Error Handling

```python
# API endpoints Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ÑÑ‚ JSONResponse
@app.get("/api/data")
async def get_data():
    try:
        data = await fetch_data()
        return JSONResponse({"success": True, "data": data})
    except Exception as e:
        return JSONResponse({"success": False, "error": str(e)})
```

### Database Operations

```python
# Ğ’ÑĞµ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ñ‡ĞµÑ€ĞµĞ· async database
async def save_order(data: dict):
    query = orders.insert().values(**data)
    return await database.execute(query)
```

### Session Management

```python
# Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ² session_data (in-memory)
session_data[session_id] = {
    "revenue_data": [...],
    "diagnostic_data": [...],
    "period": "16-30.11.25"
}
```
