# Структура Excel отчётов

## Оглавление

1. [Общий отчёт](#общий-отчёт)
2. [Отчёт для монтажников](#отчёт-для-монтажников)
3. [Индивидуальный отчёт](#индивидуальный-отчёт)
4. [Стили и форматирование](#стили-и-форматирование)

---

## Общий отчёт

**Файл**: `Общий_отчет_16-30_11_25.xlsx`

**Назначение**: Полный отчёт для бухгалтерии со всеми данными.

### Структура колонок

| Колонка | Название | Ширина | Описание |
|---------|----------|--------|----------|
| A | Монтажник | 45 | ФИО или адрес заказа |
| B | Выручка итого | 12 | Общая выручка |
| C | Выручка от услуг | 12 | Выручка от услуг |
| D | Диагностика | 12 | Сумма диагностики |
| E | Оплата диагностики | 10 | Оплата диагностики |
| F | Выручка (вызов) специалиста | 10 | Выезд специалиста |
| G | Доп. расходы (Оплата услуг помощников) | 12 | Доп. расходы |
| H | Сумма оплаты от услуг | 12 | Оплата услуг |
| I | Процент от выручки по услугам | 10 | Процент |
| J | Оплата бензина | 10 | Бензин |
| K | Транспортные | 10 | Транспортные |
| L | Яндекс заправки | 14 | Вычет Яндекс Заправки |
| M | Итого | 12 | **Итоговая сумма** |
| N | Диагностика -50% | 14 | Диагностика для клиентских заказов |

### Структура строк

```
Строка 1: Параметры:
Строка 2: Период: 16-30.11.25
Строка 3: Процент оплаты диагностики: 50%
Строка 4: [Заголовки колонок]
Строка 5: [Имя монтажника] ← Жёлтый фон, жирный шрифт
Строка 6:   [Заказ 1]
Строка 7:   [Заказ 2]
...
Строка N: [Имя монтажника (оплата клиентом)] ← Если есть
Строка N+1:   [Клиентский заказ 1]
...
```

### Итоговая строка монтажника

| Колонка | Значение |
|---------|----------|
| A | ФИО монтажника |
| J | Сумма бензина |
| K | Сумма транспортных |
| L | -Вычет Яндекс Заправки (отрицательное) |
| M | **Итого** (жёлтый фон) |
| N | Диагностика -50% (если есть клиентские) |

### Формула итого

```
Итого = Σ(total заказов) - Диагностика_50% - Яндекс_заправки

где total заказа = Оплата_услуг + Бензин + Транспортные
```

---

## Отчёт для монтажников

**Файл**: `Для_монтажников_16-30_11_25.xlsx`

**Назначение**: Упрощённый отчёт для выдачи монтажникам (скрыты конфиденциальные колонки).

### Скрытые колонки

- B: Выручка итого
- C: Выручка от услуг
- D: Диагностика
- F: Выезд специалиста
- G: Доп. расходы

### Видимые колонки

| Колонка | Название |
|---------|----------|
| A | Монтажник |
| E | Оплата диагностики |
| H | Сумма оплаты от услуг |
| I | Процент |
| J | Оплата бензина |
| K | Транспортные |
| L | Яндекс заправки |
| M | Итого |
| N | Диагностика -50% |

---

## Индивидуальный отчёт

**Файл**: `Ветренко_16-30_11_25.xlsx`

**Назначение**: Отчёт по одному монтажнику.

### Структура

Идентична общему отчёту, но содержит только заказы одного монтажника.

### Формат имени файла

```
{Фамилия}_{Период}.xlsx

Примеры:
- Ветренко_16-30_11_25.xlsx
- Фадин_01-15_12_25.xlsx
```

---

## Стили и форматирование

### Цвета

```python
# Заголовки
HEADER_FILL = PatternFill("solid", fgColor="4472C4")  # Синий
HEADER_FONT = Font(bold=True, color="FFFFFF")          # Белый текст

# Строка монтажника
WORKER_FILL = PatternFill("solid", fgColor="E2EFDA")  # Светло-зелёный
WORKER_FONT = Font(bold=True)

# Итого
TOTAL_FILL = PatternFill("solid", fgColor="FFFF00")   # Жёлтый

# Чередование строк
ODD_ROW_FILL = PatternFill("solid", fgColor="F2F2F2") # Светло-серый
```

### Границы

```python
THIN_BORDER = Border(
    left=Side(style='thin'),
    right=Side(style='thin'),
    top=Side(style='thin'),
    bottom=Side(style='thin')
)
```

### Выравнивание

```python
# Заголовки
HEADER_ALIGN = Alignment(horizontal='center', vertical='center', wrap_text=True)

# Числа
NUMBER_ALIGN = Alignment(horizontal='right')

# Текст
TEXT_ALIGN = Alignment(horizontal='left')
```

### Форматы чисел

```python
# Целые числа с разделителем тысяч
NUMBER_FORMAT = '#,##0'

# Проценты
PERCENT_FORMAT = '0%'
```

---

## Пример структуры файла

```
┌─────────────────────────────────────────────────────────────────────────┐
│ A              │ B      │ C      │...│ J    │ K    │ L     │ M     │ N  │
├────────────────┼────────┼────────┼───┼──────┼──────┼───────┼───────┼────┤
│ Параметры:     │        │        │   │      │      │       │       │    │
│ Период: 16-30..│        │        │   │      │      │       │       │    │
│ Процент: 50%   │        │        │   │      │      │       │       │    │
├────────────────┼────────┼────────┼───┼──────┼──────┼───────┼───────┼────┤
│ Монтажник      │Выручка │Выручка │...│Бензин│Трансп│Яндекс │ ИТОГО │Диаг│
│                │ итого  │от услуг│   │      │      │заправ │       │-50%│
├────────────────┼────────┼────────┼───┼──────┼──────┼───────┼───────┼────┤
│▒Ветренко Дмитр▒│        │        │   │  300 │ 1000 │       │▒66180▒│    │ ← Жёлтый
│ Москва, Мосфил.│  27065 │  27065 │   │  300 │ 1000 │       │  9420 │    │
│ МСК, Шатура... │   5600 │      0 │   │      │      │       │  5600 │    │
│ ...            │        │        │   │      │      │       │       │    │
├────────────────┼────────┼────────┼───┼──────┼──────┼───────┼───────┼────┤
│▒Ветренко (опла▒│        │        │   │      │      │       │▒18250▒│1500│ ← Жёлтый
│ Большая Лубянк.│   1000 │      0 │   │      │      │       │  1000 │    │
│ ...            │        │        │   │      │      │       │       │    │
├────────────────┼────────┼────────┼───┼──────┼──────┼───────┼───────┼────┤
│▒Викулин Андрей▒│        │        │   │ 2900 │ 5000 │ -9306 │▒58863▒│    │ ← Яндекс вычет
│ ...            │        │        │   │      │      │       │       │    │
└────────────────┴────────┴────────┴───┴──────┴──────┴───────┴───────┴────┘
```

---

## Генерация отчётов

### Функция создания

```python
def create_excel_report(
    calculated_data: list,      # Рассчитанные данные
    period: str,                # "16-30.11.25"
    config: dict,               # Конфигурация (включая yandex_fuel)
    for_workers: bool = False   # True = скрыть колонки
) -> bytes:
    """Создаёт Excel-отчёт и возвращает bytes"""
```

### Архивы

```python
# Архив для бухгалтерии (все колонки видны)
zip_full = create_archive(calculated_data, period, config, for_workers=False)

# Архив для монтажников (скрытые колонки)
zip_workers = create_archive(calculated_data, period, config, for_workers=True)
```
