# üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ ‚Äî –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–û–±–∑–æ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π](#–æ–±–∑–æ—Ä-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π)
2. [Yandex Geocoder](#yandex-geocoder)
3. [Bitrix24 API](#bitrix24-api)
4. [1–° —á–µ—Ä–µ–∑ Excel](#1—Å-—á–µ—Ä–µ–∑-excel)
5. [–Ø–Ω–¥–µ–∫—Å –ó–∞–ø—Ä–∞–≤–∫–∏](#—è–Ω–¥–µ–∫—Å-–∑–∞–ø—Ä–∞–≤–∫–∏)

---

## –û–±–∑–æ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                       SALARY SERVICE                             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ
‚îÇ  ‚îÇ   Yandex    ‚îÇ    ‚îÇ  Bitrix24   ‚îÇ    ‚îÇ     1–°      ‚îÇ          ‚îÇ
‚îÇ  ‚îÇ  Geocoder   ‚îÇ    ‚îÇ   OAuth     ‚îÇ    ‚îÇ   (Excel)   ‚îÇ          ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îÇ         ‚îÇ                  ‚îÇ                  ‚îÇ                  ‚îÇ
‚îÇ         ‚ñº                  ‚ñº                  ‚ñº                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ
‚îÇ  ‚îÇ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã  ‚îÇ    ‚îÇ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è ‚îÇ    ‚îÇ   –ó–∞–∫–∞–∑—ã    ‚îÇ          ‚îÇ
‚îÇ  ‚îÇ ‚Üí –ë–µ–Ω–∑–∏–Ω    ‚îÇ    ‚îÇ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ‚îÇ    ‚îÇ   –î–∞–Ω–Ω—ã–µ    ‚îÇ          ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | –¢–∏–ø | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------------|-----|------------|
| Yandex Geocoder | REST API | –ê–¥—Ä–µ—Å ‚Üí –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã ‚Üí –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ |
| Bitrix24 | OAuth2 + REST API | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è |
| 1–° | Excel —Ñ–∞–π–ª—ã | –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞–∫–∞–∑–∞—Ö |
| –Ø–Ω–¥–µ–∫—Å –ó–∞–ø—Ä–∞–≤–∫–∏ | Excel —Ñ–∞–π–ª—ã | –î–∞–Ω–Ω—ã–µ –æ –∑–∞–ø—Ä–∞–≤–∫–∞—Ö |

---

## Yandex Geocoder

### –û–ø–∏—Å–∞–Ω–∏–µ

Yandex Geocoder API –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∞–¥—Ä–µ—Å–∞ –≤ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –æ—Ç –æ—Ñ–∏—Å–∞ –¥–æ –∞–¥—Ä–µ—Å–∞ –∑–∞–∫–∞–∑–∞.

### API Details

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| Endpoint | `https://geocode-maps.yandex.ru/1.x/` |
| –ú–µ—Ç–æ–¥ | GET |
| –§–æ—Ä–º–∞—Ç | JSON |
| –õ–∏–º–∏—Ç (–±–µ—Å–ø–ª–∞—Ç–Ω–æ) | 1000 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å |
| –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | [tech.yandex.ru/maps/geocoder](https://tech.yandex.ru/maps/geocoder/) |

### –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–∞

1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ [developer.tech.yandex.ru](https://developer.tech.yandex.ru)
2. –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –ü–æ–¥–∫–ª—é—á–∏—Ç—å API "–ì–µ–æ–∫–æ–¥–µ—Ä"
4. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å API –∫–ª—é—á

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```env
YANDEX_GEOCODER_API_KEY=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

```python
# services/geocoding.py

import httpx
from config import YANDEX_GEOCODER_API_KEY

GEOCODER_URL = "https://geocode-maps.yandex.ru/1.x/"

async def geocode_address_yandex(address: str) -> tuple:
    """
    –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∞–¥—Ä–µ—Å –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —á–µ—Ä–µ–∑ Yandex Geocoder.
    
    Args:
        address: –¢–µ–∫—Å—Ç–æ–≤—ã–π –∞–¥—Ä–µ—Å (–Ω–∞–ø—Ä. "–ú–æ—Å–∫–≤–∞, —É–ª. –õ–µ–Ω–∏–Ω–∞, 1")
        
    Returns:
        tuple: (latitude, longitude) –∏–ª–∏ None –ø—Ä–∏ –æ—à–∏–±–∫–µ
    """
    params = {
        "apikey": YANDEX_GEOCODER_API_KEY,
        "geocode": address,
        "format": "json",
        "results": 1,
    }
    
    async with httpx.AsyncClient() as client:
        response = await client.get(GEOCODER_URL, params=params)
    
    if response.status_code != 200:
        return None
    
    data = response.json()
    
    try:
        # –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∏–∑ –æ—Ç–≤–µ—Ç–∞
        pos = data["response"]["GeoObjectCollection"]["featureMember"][0]
        pos = pos["GeoObject"]["Point"]["pos"]
        lon, lat = map(float, pos.split())
        return (lat, lon)
    except (KeyError, IndexError):
        return None
```

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞/–æ—Ç–≤–µ—Ç–∞

**–ó–∞–ø—Ä–æ—Å:**
```
GET https://geocode-maps.yandex.ru/1.x/?apikey=xxx&geocode=–ú–æ—Å–∫–≤–∞,+–¢–≤–µ—Ä—Å–∫–∞—è+1&format=json
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "response": {
    "GeoObjectCollection": {
      "featureMember": [
        {
          "GeoObject": {
            "Point": {
              "pos": "37.611347 55.757660"
            },
            "metaDataProperty": {
              "GeocoderMetaData": {
                "Address": {
                  "formatted": "–†–æ—Å—Å–∏—è, –ú–æ—Å–∫–≤–∞, –¢–≤–µ—Ä—Å–∫–∞—è —É–ª–∏—Ü–∞, 1"
                }
              }
            }
          }
        }
      ]
    }
  }
}
```

### –†–∞—Å—á—ë—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è

```python
from math import radians, sin, cos, sqrt, atan2

OFFICE_COORDS = (55.8309, 37.4294)  # –°—Ö–æ–¥–Ω–µ–Ω—Å–∫–∏–π —Ç—É–ø–∏–∫ 16—Å4

def calculate_distance(coords: tuple) -> float:
    """
    –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –¥–≤—É–º—è —Ç–æ—á–∫–∞–º–∏ –ø–æ —Ñ–æ—Ä–º—É–ª–µ Haversine.
    
    Args:
        coords: (latitude, longitude) —Ü–µ–ª–µ–≤–æ–π —Ç–æ—á–∫–∏
        
    Returns:
        float: –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤ –∫–∏–ª–æ–º–µ—Ç—Ä–∞—Ö
    """
    lat1, lon1 = OFFICE_COORDS
    lat2, lon2 = coords
    
    R = 6371  # –†–∞–¥–∏—É—Å –ó–µ–º–ª–∏ –≤ –∫–º
    
    dlat = radians(lat2 - lat1)
    dlon = radians(lon2 - lon1)
    
    a = sin(dlat/2)**2 + cos(radians(lat1)) * cos(radians(lat2)) * sin(dlon/2)**2
    c = 2 * atan2(sqrt(a), sqrt(1-a))
    
    return R * c
```

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
# In-memory –∫—ç—à –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ API –∑–∞–ø—Ä–æ—Å–æ–≤
distance_cache = {}

async def get_distance_cached(address: str) -> float:
    """–ü–æ–ª—É—á–∞–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º"""
    
    # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∞–¥—Ä–µ—Å –¥–ª—è –∫–ª—é—á–∞ –∫—ç—à–∞
    cache_key = address.lower().strip()
    
    if cache_key in distance_cache:
        return distance_cache[cache_key]
    
    coords = await geocode_address_yandex(address)
    
    if coords is None:
        return 0
    
    distance = calculate_distance(coords)
    distance_cache[cache_key] = distance
    
    return distance
```

### Fallback –Ω–∞ Nominatim

–ï—Å–ª–∏ Yandex API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π Nominatim:

```python
NOMINATIM_URL = "https://nominatim.openstreetmap.org/search"

async def geocode_address_nominatim(address: str) -> tuple:
    """Fallback –≥–µ–æ–∫–æ–¥–µ—Ä —á–µ—Ä–µ–∑ OpenStreetMap Nominatim"""
    
    params = {
        "q": address,
        "format": "json",
        "limit": 1,
    }
    
    headers = {
        "User-Agent": "SalaryService/1.0"
    }
    
    async with httpx.AsyncClient() as client:
        response = await client.get(
            NOMINATIM_URL, 
            params=params, 
            headers=headers
        )
    
    if response.status_code != 200:
        return None
    
    data = response.json()
    
    if not data:
        return None
    
    return (float(data[0]["lat"]), float(data[0]["lon"]))
```

---

## Bitrix24 API

### –û–ø–∏—Å–∞–Ω–∏–µ

Bitrix24 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
1. **OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏** ‚Äî –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
2. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –º–æ–Ω—Ç–∞–∂–Ω–∏–∫–∞–º
3. **–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

1. **Bitrix24** ‚Üí **–ú–∞—Ä–∫–µ—Ç** ‚Üí **–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º** ‚Üí **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**

2. **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
   ```
   –ù–∞–∑–≤–∞–Ω–∏–µ: Salary Service
   –¢–∏–ø: –°–µ—Ä–≤–µ—Ä–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
   URL: https://salary.mos-gsm.ru
   Redirect URI: https://salary.mos-gsm.ru/auth/callback
   
   –ü—Ä–∞–≤–∞:
   ‚òëÔ∏è user - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
   ‚òëÔ∏è im - –°–æ–æ–±—â–µ–Ω–∏—è
   ```

3. **–ü–æ–ª—É—á–∏—Ç—å credentials:**
   - Client ID: `local.xxxxx.xxxxx`
   - Client Secret: `xxxxxxxx`

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```env
BITRIX_CLIENT_ID=local.xxxxx.xxxxx
BITRIX_CLIENT_SECRET=xxxxxxxx
BITRIX_DOMAIN=svyaz.bitrix24.ru
```

### OAuth Flow

```python
# auth.py

BITRIX_DOMAIN = os.getenv("BITRIX_DOMAIN")
BITRIX_CLIENT_ID = os.getenv("BITRIX_CLIENT_ID")
BITRIX_CLIENT_SECRET = os.getenv("BITRIX_CLIENT_SECRET")

def get_auth_url(redirect_uri: str) -> str:
    """–§–æ—Ä–º–∏—Ä—É–µ—Ç URL –¥–ª—è OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"""
    params = {
        "client_id": BITRIX_CLIENT_ID,
        "response_type": "code",
        "redirect_uri": redirect_uri,
    }
    return f"https://{BITRIX_DOMAIN}/oauth/authorize/?" + urlencode(params)


async def exchange_code_for_token(code: str, redirect_uri: str) -> dict:
    """–û–±–º–µ–Ω–∏–≤–∞–µ—Ç authorization code –Ω–∞ access token"""
    async with httpx.AsyncClient() as client:
        response = await client.post(
            f"https://{BITRIX_DOMAIN}/oauth/token/",
            data={
                "grant_type": "authorization_code",
                "client_id": BITRIX_CLIENT_ID,
                "client_secret": BITRIX_CLIENT_SECRET,
                "code": code,
                "redirect_uri": redirect_uri,
            }
        )
    return response.json()


async def get_bitrix_user(access_token: str) -> dict:
    """–ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ"""
    async with httpx.AsyncClient() as client:
        response = await client.get(
            f"https://{BITRIX_DOMAIN}/rest/user.current",
            params={"auth": access_token}
        )
    return response.json()["result"]
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

```python
async def send_bitrix_message(
    access_token: str,
    user_id: str,
    message: str
) -> bool:
    """
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ª–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é Bitrix24.
    
    Args:
        access_token: OAuth —Ç–æ–∫–µ–Ω
        user_id: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Bitrix24
        message: –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
        
    Returns:
        bool: –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏
    """
    async with httpx.AsyncClient() as client:
        response = await client.post(
            f"https://{BITRIX_DOMAIN}/rest/im.message.add",
            params={"auth": access_token},
            json={
                "DIALOG_ID": user_id,
                "MESSAGE": message,
            }
        )
    
    return response.status_code == 200
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

```python
async def get_bitrix_users(access_token: str) -> list:
    """–ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫–æ–º–ø–∞–Ω–∏–∏"""
    
    users = []
    start = 0
    
    while True:
        async with httpx.AsyncClient() as client:
            response = await client.get(
                f"https://{BITRIX_DOMAIN}/rest/user.get",
                params={
                    "auth": access_token,
                    "start": start,
                }
            )
        
        data = response.json()
        users.extend(data.get("result", []))
        
        # –ü–∞–≥–∏–Ω–∞—Ü–∏—è
        if "next" in data:
            start = data["next"]
        else:
            break
    
    return users
```

---

## 1–° —á–µ—Ä–µ–∑ Excel

### –û–ø–∏—Å–∞–Ω–∏–µ

–î–∞–Ω–Ω—ã–µ –∏–∑ 1–° –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ Excel —Ñ–∞–π–ª—ã. –°–∏—Å—Ç–µ–º–∞ –Ω–µ –∏–º–µ–µ—Ç –ø—Ä—è–º–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ 1–° ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–≥—Ä—É–∂–∞–µ—Ç —Ñ–∞–π–ª—ã –≤—Ä—É—á–Ω—É—é.

### –ü—Ä–æ—Ü–µ—Å—Å –∏–º–ø–æ—Ä—Ç–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    –í—ã–≥—Ä—É–∑–∫–∞     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    –ó–∞–≥—Ä—É–∑–∫–∞    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   1–°    ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ  Excel  ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ Salary  ‚îÇ
‚îÇ         ‚îÇ    (–≤—Ä—É—á–Ω—É—é)    ‚îÇ  —Ñ–∞–π–ª—ã  ‚îÇ    (web UI)    ‚îÇ Service ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –¢–∏–ø—ã —Ñ–∞–π–ª–æ–≤

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π |
|------|----------|--------------|
| –í—ã—Ä—É—á–∫–∞ | –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã | ‚úÖ –î–∞ |
| –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ | –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã | ‚úÖ –î–∞ |
| –Ø–Ω–¥–µ–∫—Å –ó–∞–ø—Ä–∞–≤–∫–∏ | –î–∞–Ω–Ω—ã–µ –æ –∑–∞–ø—Ä–∞–≤–∫–∞—Ö | ‚ö†Ô∏è –î–ª—è 16-30/31 |

### –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ –≤—ã—Ä—É—á–∫–∏

–°—Ç—Ä–æ–∫–∞ "–û—Ç–±–æ—Ä" –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø:
```
"–û—Ç–±–æ—Ä: –¢–∏–ø —Ä–∞–±–æ—Ç—ã - –Ω–µ —Ä–∞–≤–Ω–æ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞; ..."
```

–ö–æ–ª–æ–Ω–∫–∏:
| –ö–æ–ª–æ–Ω–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| –ú–æ–Ω—Ç–∞–∂–Ω–∏–∫ | –§–ò–û |
| –ó–∞–∫–∞–∑ | –ù–æ–º–µ—Ä –∏ –¥–µ—Ç–∞–ª–∏ |
| –ê–¥—Ä–µ—Å | –ê–¥—Ä–µ—Å –æ–±—ä–µ–∫—Ç–∞ |
| –í—ã—Ä—É—á–∫–∞ –∏—Ç–æ–≥–æ | –û–±—â–∞—è —Å—É–º–º–∞ |
| –í—ã—Ä—É—á–∫–∞ –æ—Ç —É—Å–ª—É–≥ | –ó–∞ —Ä–∞–±–æ—Ç—É |
| –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ | –°—É–º–º–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ |
| –í—ã–µ–∑–¥ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ | –û–ø–ª–∞—Ç–∞ –≤—ã–µ–∑–¥–∞ |
| –û–ø–ª–∞—Ç–∞ —É—Å–ª—É–≥ | –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–∞—è —Å—É–º–º–∞ |
| % | –ü—Ä–æ—Ü–µ–Ω—Ç –º–æ–Ω—Ç–∞–∂–Ω–∏–∫–∞ |

### –ü–∞—Ä—Å–∏–Ω–≥

```python
# services/excel_parser.py

def parse_1c_file(file: BytesIO) -> dict:
    """
    –ü–∞—Ä—Å–∏—Ç Excel —Ñ–∞–π–ª –∏–∑ 1–°.
    
    Returns:
        {
            "type": "revenue" | "diagnostic",
            "period": "16-30.11.25",
            "orders": [...]
        }
    """
    df = pd.read_excel(file)
    
    file_type = detect_file_type(df)
    period = extract_period(df)
    orders = parse_orders(df)
    
    return {
        "type": file_type,
        "period": period,
        "orders": orders,
    }
```

---

## –Ø–Ω–¥–µ–∫—Å –ó–∞–ø—Ä–∞–≤–∫–∏

### –û–ø–∏—Å–∞–Ω–∏–µ

–ö–æ–º–ø–∞–Ω–∏—è –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç —Ç–æ–ø–ª–∏–≤–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å –ó–∞–ø—Ä–∞–≤–∫–∏. –í –∫–æ–Ω—Ü–µ –º–µ—Å—è—Ü–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –æ—Ç—á—ë—Ç –ø–æ –∑–∞–ø—Ä–∞–≤–∫–∞–º.

### –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞

| –§–ò–û | –°—É–º–º–∞ |
|-----|-------|
| –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á | 10 000 |
| –ü–µ—Ç—Ä–æ–≤ –ü—ë—Ç—Ä –ü–µ—Ç—Ä–æ–≤–∏—á | 8 500 |

### –ü–∞—Ä—Å–∏–Ω–≥

```python
# services/yandex_fuel_parser.py

def parse_yandex_fuel(file: BytesIO) -> dict:
    """
    –ü–∞—Ä—Å–∏—Ç —Ñ–∞–π–ª –Ø–Ω–¥–µ–∫—Å –ó–∞–ø—Ä–∞–≤–∫–∏.
    
    Returns:
        {"–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω": 10000, "–ü–µ—Ç—Ä–æ–≤ –ü—ë—Ç—Ä": 8500, ...}
    """
    df = pd.read_excel(file)
    
    result = {}
    
    for _, row in df.iterrows():
        name = str(row.iloc[0]).strip()
        amount = float(row.iloc[1]) if pd.notna(row.iloc[1]) else 0
        
        if name and amount > 0:
            # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –∏–º—è –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è
            normalized = normalize_worker_name(name)
            result[normalized] = amount
    
    return result
```

### –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å –º–æ–Ω—Ç–∞–∂–Ω–∏–∫–∞–º–∏

–ò–º–µ–Ω–∞ –≤ —Ñ–∞–π–ª–µ –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç –∏–º—ë–Ω –≤ –∑–∞–∫–∞–∑–∞—Ö:

```python
def match_fuel_to_workers(fuel_data: dict, workers: list) -> dict:
    """
    –°–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–∞–≤–æ–∫ —Å –º–æ–Ω—Ç–∞–∂–Ω–∏–∫–∞–º–∏.
    
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç fuzzy matching –¥–ª—è –Ω–µ—Ç–æ—á–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π.
    """
    matched = {}
    
    for fuel_name, amount in fuel_data.items():
        # –ü—Ä–æ–±—É–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
        if fuel_name in workers:
            matched[fuel_name] = amount
            continue
        
        # –ü—Ä–æ–±—É–µ–º –ø–æ —Ñ–∞–º–∏–ª–∏–∏ + –∏–º–µ–Ω–∏
        fuel_short = " ".join(fuel_name.split()[:2])
        
        for worker in workers:
            worker_short = " ".join(worker.split()[:2])
            
            if fuel_short.lower() == worker_short.lower():
                matched[worker] = amount
                break
    
    return matched
```

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤—ã—á–µ—Ç–∞

```python
def apply_yandex_fuel(worker_total: float, fuel_amount: float) -> float:
    """
    –ü—Ä–∏–º–µ–Ω—è–µ—Ç –≤—ã—á–µ—Ç –Ø–Ω–¥–µ–∫—Å –ó–∞–ø—Ä–∞–≤–æ–∫.
    
    –í—ã—á–∏—Ç–∞–µ—Ç—Å—è 90% –æ—Ç —Å—É–º–º—ã –∑–∞–ø—Ä–∞–≤–æ–∫ (—Å–∫–∏–¥–∫–∞ 10% –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞).
    """
    deduction = fuel_amount * 0.9
    return worker_total - deduction
```
