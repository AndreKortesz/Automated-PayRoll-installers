# üìë –ü–∞—Ä—Å–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤ 1–° ‚Äî –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–¢–∏–ø—ã —Ñ–∞–π–ª–æ–≤](#—Ç–∏–ø—ã-—Ñ–∞–π–ª–æ–≤)
2. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞ –≤—ã—Ä—É—á–∫–∏](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-—Ñ–∞–π–ª–∞-–≤—ã—Ä—É—á–∫–∏)
3. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-—Ñ–∞–π–ª–∞-–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏)
4. [–ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞](#–∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ-—Ç–∏–ø–∞-—Ñ–∞–π–ª–∞)
5. [–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–µ—Ä–∏–æ–¥–∞](#–∏–∑–≤–ª–µ—á–µ–Ω–∏–µ-–Ω–∞–∑–≤–∞–Ω–∏—è-–ø–µ—Ä–∏–æ–¥–∞)
6. [–ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–æ–∫ –¥–∞–Ω–Ω—ã—Ö](#–ø–∞—Ä—Å–∏–Ω–≥-—Å—Ç—Ä–æ–∫-–¥–∞–Ω–Ω—ã—Ö)
7. [–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏–º—ë–Ω –º–æ–Ω—Ç–∞–∂–Ω–∏–∫–æ–≤](#–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è-–∏–º—ë–Ω-–º–æ–Ω—Ç–∞–∂–Ω–∏–∫–æ–≤)
8. [–û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤](#–æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ-—Ñ–∞–π–ª–æ–≤)
9. [–§–∞–π–ª –Ø–Ω–¥–µ–∫—Å –ó–∞–ø—Ä–∞–≤–∫–∏](#—Ñ–∞–π–ª-—è–Ω–¥–µ–∫—Å-–∑–∞–ø—Ä–∞–≤–∫–∏)
10. [–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-–æ—à–∏–±–æ–∫)

---

## –¢–∏–ø—ã —Ñ–∞–π–ª–æ–≤

### –í—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|--------------|----------|
| **–í—ã—Ä—É—á–∫–∞** | ‚úÖ –î–∞ | –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã —Å —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏ |
| **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** | ‚úÖ –î–∞ | –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã |
| **–Ø–Ω–¥–µ–∫—Å –ó–∞–ø—Ä–∞–≤–∫–∏** | ‚ö†Ô∏è –î–ª—è 16-30/31 | –°—É–º–º—ã –∑–∞–ø—Ä–∞–≤–æ–∫ |

### –§–æ—Ä–º–∞—Ç—ã

- Excel: `.xlsx`, `.xls`
- –ö–æ–¥–∏—Ä–æ–≤–∫–∞: UTF-8
- –Ø–∑—ã–∫: –†—É—Å—Å–∫–∏–π

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞ –≤—ã—Ä—É—á–∫–∏

### –û–±—â–∏–π –≤–∏–¥

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ A              ‚îÇ B       ‚îÇ C      ‚îÇ D         ‚îÇ ... ‚îÇ J    ‚îÇ K     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –û—Ç–±–æ—Ä          ‚îÇ         ‚îÇ        ‚îÇ           ‚îÇ     ‚îÇ      ‚îÇ       ‚îÇ
‚îÇ –Ω–µ —Ä–∞–≤–Ω–æ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞; –ö—É—Ä—Å–∏–≤–æ–º –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–∫–∞–∑—ã              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                ‚îÇ         ‚îÇ        ‚îÇ           ‚îÇ     ‚îÇ      ‚îÇ       ‚îÇ
‚îÇ –ó–∞–∫–∞–∑ 16-30.11.25 –æ—Ç –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞ –ö–æ–º–ø–∞–Ω–∏—è                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                ‚îÇ         ‚îÇ        ‚îÇ           ‚îÇ     ‚îÇ      ‚îÇ       ‚îÇ
‚îÇ –ú–æ–Ω—Ç–∞–∂–Ω–∏–∫      ‚îÇ –ó–∞–∫–∞–∑   ‚îÇ –ê–¥—Ä–µ—Å  ‚îÇ –í—ã—Ä.–∏—Ç–æ–≥–æ ‚îÇ ... ‚îÇ –û–ø–ª. ‚îÇ %     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –ò–≤–∞–Ω–æ–≤ –ò.–ò.    ‚îÇ –ö–ê–£–¢-...‚îÇ –ú–æ—Å–∫–≤–∞ ‚îÇ 50000     ‚îÇ ... ‚îÇ 15000‚îÇ 30%   ‚îÇ
‚îÇ –ò–≤–∞–Ω–æ–≤ –ò.–ò.    ‚îÇ –ö–ê–£–¢-...‚îÇ –¢–≤–µ—Ä—å  ‚îÇ 30000     ‚îÇ ... ‚îÇ 9000 ‚îÇ 30%   ‚îÇ
‚îÇ                ‚îÇ         ‚îÇ        ‚îÇ           ‚îÇ     ‚îÇ      ‚îÇ       ‚îÇ
‚îÇ –ò—Ç–æ–≥–æ –ò–≤–∞–Ω–æ–≤   ‚îÇ         ‚îÇ        ‚îÇ 80000     ‚îÇ     ‚îÇ24000 ‚îÇ       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –ü–µ—Ç—Ä–æ–≤ –ü.–ü.    ‚îÇ –ö–ê–£–¢-...‚îÇ ...    ‚îÇ ...       ‚îÇ ... ‚îÇ ...  ‚îÇ ...   ‚îÇ
‚îÇ ...            ‚îÇ         ‚îÇ        ‚îÇ           ‚îÇ     ‚îÇ      ‚îÇ       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–æ–ª–æ–Ω–∫–∏ —Ñ–∞–π–ª–∞ –≤—ã—Ä—É—á–∫–∏

| # | –ù–∞–∑–≤–∞–Ω–∏–µ | –ü–æ–ª–µ –≤ –ë–î | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|----------|-----------|-----|----------|
| A | –ú–æ–Ω—Ç–∞–∂–Ω–∏–∫ | `worker` | string | –§–ò–û –º–æ–Ω—Ç–∞–∂–Ω–∏–∫–∞ |
| B | –ó–∞–∫–∞–∑ | `order_code`, `order_full` | string | –ù–æ–º–µ—Ä –∏ –¥–µ—Ç–∞–ª–∏ |
| C | –ê–¥—Ä–µ—Å | `address` | string | –ê–¥—Ä–µ—Å –æ–±—ä–µ–∫—Ç–∞ |
| D | –í—ã—Ä—É—á–∫–∞ –∏—Ç–æ–≥–æ | `revenue_total` | float | –û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞ |
| E | –í—ã—Ä—É—á–∫–∞ –æ—Ç —É—Å–ª—É–≥ | `revenue_services` | float | –í—ã—Ä—É—á–∫–∞ –∑–∞ —Ä–∞–±–æ—Ç—É |
| F | –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ | `diagnostic` | float | –°—É–º–º–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ |
| G | –û–ø–ª–∞—Ç–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ | `diagnostic_payment` | float | –û–ø–ª–∞—Ç–∞ –∑–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É |
| H | –í—ã–µ–∑–¥ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ | `specialist_fee` | float | –û–ø–ª–∞—Ç–∞ –≤—ã–µ–∑–¥–∞ |
| I | –î–æ–ø. —Ä–∞—Å—Ö–æ–¥—ã | `additional_expenses` | float | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ |
| J | –û–ø–ª–∞—Ç–∞ —É—Å–ª—É–≥ | `service_payment` | float | –†–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–∞—è –æ–ø–ª–∞—Ç–∞ |
| K | % | `percent` | string | –ü—Ä–æ—Ü–µ–Ω—Ç –º–æ–Ω—Ç–∞–∂–Ω–∏–∫–∞ |

### –°—Ç—Ä–æ–∫–∞ "–û—Ç–±–æ—Ä"

–°—Ç—Ä–æ–∫–∞ "–û—Ç–±–æ—Ä" –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø —Ñ–∞–π–ª–∞:

```
–§–∞–π–ª –≤—ã—Ä—É—á–∫–∏:
"–û—Ç–±–æ—Ä: –Ω–µ —Ä–∞–≤–Ω–æ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞; –ö—É—Ä—Å–∏–≤–æ–º –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–∫–∞–∑—ã"
                ‚Üë
            "–Ω–µ —Ä–∞–≤–Ω–æ"

–§–∞–π–ª –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:
"–û—Ç–±–æ—Ä: —Ä–∞–≤–Ω–æ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞; –ö—É—Ä—Å–∏–≤–æ–º –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–∫–∞–∑—ã"
            ‚Üë
        "—Ä–∞–≤–Ω–æ" (–±–µ–∑ "–Ω–µ")
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –û—Ç–ª–∏—á–∏—è –æ—Ç –≤—ã—Ä—É—á–∫–∏

1. **–°—Ç—Ä–æ–∫–∞ "–û—Ç–±–æ—Ä"** —Å–æ–¥–µ—Ä–∂–∏—Ç `"—Ä–∞–≤–Ω–æ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞"` (–±–µ–∑ "–Ω–µ")
2. **–°–æ–¥–µ—Ä–∂–∏–º–æ–µ** ‚Äî —Ç–æ–ª—å–∫–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞–±–æ—Ç—ã
3. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–ª–æ–Ω–æ–∫** ‚Äî –∏–¥–µ–Ω—Ç–∏—á–Ω–∞—è

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–§–∞–π–ª –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
- –†–∞—Å—á—ë—Ç–∞ "–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ -50%" –¥–ª—è –∑–∞–∫–∞–∑–æ–≤ —Å –æ–ø–ª–∞—Ç–æ–π –∫–ª–∏–µ–Ω—Ç–æ–º
- –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Ñ–∞–π–ª–æ–º –≤—ã—Ä—É—á–∫–∏ –¥–ª—è –ø–æ–ª–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω—ã

---

## –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞

### –ê–ª–≥–æ—Ä–∏—Ç–º

```python
def detect_file_type(df: pd.DataFrame) -> str:
    """
    –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø —Ñ–∞–π–ª–∞ –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É.
    
    Returns:
        'revenue' | 'diagnostic' | 'yandex_fuel' | 'unknown'
    """
    # –ò—â–µ–º —Å—Ç—Ä–æ–∫—É "–û—Ç–±–æ—Ä" –≤ –ø–µ—Ä–≤—ã—Ö 30 —Å—Ç—Ä–æ–∫–∞—Ö
    for row_idx in range(min(30, len(df))):
        for col_idx in range(min(5, len(df.columns))):
            cell = str(df.iloc[row_idx, col_idx]).lower()
            
            if "–æ—Ç–±–æ—Ä" in cell:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—Ç—Ä–æ–∫–∏
                row_text = " ".join(str(x) for x in df.iloc[row_idx])
                
                if "–Ω–µ —Ä–∞–≤–Ω–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞" in row_text.lower():
                    return "revenue"
                elif "—Ä–∞–≤–Ω–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞" in row_text.lower():
                    return "diagnostic"
    
    # Fallback: –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —Ñ–∞–π–ª–∞
    return "unknown"
```

### –ü—Ä–∏–º–µ—Ä—ã —Å—Ç—Ä–æ–∫ "–û—Ç–±–æ—Ä"

```python
# –§–∞–π–ª –≤—ã—Ä—É—á–∫–∏:
"–û—Ç–±–æ—Ä: –¢–∏–ø —Ä–∞–±–æ—Ç—ã - –Ω–µ —Ä–∞–≤–Ω–æ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞; –ö—É—Ä—Å–∏–≤–æ–º –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–∫–∞–∑—ã"

# –§–∞–π–ª –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:
"–û—Ç–±–æ—Ä: –¢–∏–ø —Ä–∞–±–æ—Ç—ã - —Ä–∞–≤–Ω–æ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞; –ö—É—Ä—Å–∏–≤–æ–º –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–∫–∞–∑—ã"
```

---

## –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–µ—Ä–∏–æ–¥–∞

### –ê–ª–≥–æ—Ä–∏—Ç–º

```python
def extract_period(df: pd.DataFrame) -> str:
    """
    –ò—â–µ—Ç —Å—Ç—Ä–æ–∫—É –≤–∏–¥–∞: "–ó–∞–∫–∞–∑ 16-30.11.25 –æ—Ç –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞"
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: "16-30.11.25"
    """
    import re
    
    # –ü–∞—Ç—Ç–µ—Ä–Ω: DD-DD.MM.YY
    pattern = r'(\d{1,2}-\d{1,2}\.\d{2}\.\d{2})'
    
    for row_idx in range(min(20, len(df))):
        for col_idx in range(min(10, len(df.columns))):
            cell = str(df.iloc[row_idx, col_idx])
            
            match = re.search(pattern, cell)
            if match:
                return match.group(1)
    
    return None
```

### –§–æ—Ä–º–∞—Ç—ã –ø–µ—Ä–∏–æ–¥–æ–≤

| –¢–∏–ø | –ü—Ä–∏–º–µ—Ä | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|--------|----------|
| –ü–µ—Ä–≤–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞ | `01-15.11.25` | 1-15 —á–∏—Å–ª–æ –º–µ—Å—è—Ü–∞ |
| –í—Ç–æ—Ä–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞ | `16-30.11.25` | 16-30 —á–∏—Å–ª–æ |
| –î–µ–∫–∞–±—Ä—å | `16-31.12.25` | 31 –¥–µ–Ω—å |
| –§–µ–≤—Ä–∞–ª—å | `16-28.02.25` | 28 –∏–ª–∏ 29 –¥–Ω–µ–π |

---

## –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–æ–∫ –¥–∞–Ω–Ω—ã—Ö

### –ü–æ–∏—Å–∫ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

```python
def find_header_row(df: pd.DataFrame) -> int:
    """
    –ò—â–µ—Ç —Å—Ç—Ä–æ–∫—É —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –∫–æ–ª–æ–Ω–æ–∫.
    –ü—Ä–∏–∑–Ω–∞–∫–∏: "–ú–æ–Ω—Ç–∞–∂–Ω–∏–∫", "–ó–∞–∫–∞–∑", "–ê–¥—Ä–µ—Å", etc.
    """
    keywords = ["–º–æ–Ω—Ç–∞–∂–Ω–∏–∫", "–∑–∞–∫–∞–∑", "–∞–¥—Ä–µ—Å", "–≤—ã—Ä—É—á–∫–∞"]
    
    for row_idx in range(min(30, len(df))):
        row_text = " ".join(str(x).lower() for x in df.iloc[row_idx])
        
        matches = sum(1 for kw in keywords if kw in row_text)
        if matches >= 2:
            return row_idx
    
    return None
```

### –ú–∞–ø–ø–∏–Ω–≥ –∫–æ–ª–æ–Ω–æ–∫

```python
COLUMN_MAPPING = {
    "–º–æ–Ω—Ç–∞–∂–Ω–∏–∫": "worker",
    "–∑–∞–∫–∞–∑": "order_full",
    "–∞–¥—Ä–µ—Å": "address",
    "–≤—ã—Ä—É—á–∫–∞ –∏—Ç–æ–≥–æ": "revenue_total",
    "–≤—ã—Ä—É—á–∫–∞ –æ—Ç —É—Å–ª—É–≥": "revenue_services",
    "–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞": "diagnostic",
    "–æ–ø–ª–∞—Ç–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏": "diagnostic_payment",
    "–≤—ã–µ–∑–¥ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞": "specialist_fee",
    "–¥–æ–ø. —Ä–∞—Å—Ö–æ–¥—ã": "additional_expenses",
    "–æ–ø–ª–∞—Ç–∞ —É—Å–ª—É–≥": "service_payment",
    "%": "percent",
}

def map_columns(df: pd.DataFrame, header_row: int) -> dict:
    """
    –°–æ–∑–¥–∞—ë—Ç —Å–ª–æ–≤–∞—Ä—å: –Ω–æ–º–µ—Ä –∫–æ–ª–æ–Ω–∫–∏ ‚Üí –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–ª—è
    """
    mapping = {}
    headers = df.iloc[header_row]
    
    for col_idx, header in enumerate(headers):
        header_lower = str(header).lower().strip()
        
        for keyword, field in COLUMN_MAPPING.items():
            if keyword in header_lower:
                mapping[col_idx] = field
                break
    
    return mapping
```

### –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–æ–∫–∏ –∑–∞–∫–∞–∑–∞

```python
def parse_order_row(row: pd.Series, col_mapping: dict) -> dict:
    """
    –ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å—Ç—Ä–æ–∫–∏ DataFrame.
    """
    order = {}
    
    for col_idx, field in col_mapping.items():
        value = row.iloc[col_idx]
        
        # –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤
        if field in ["revenue_total", "revenue_services", "service_payment"]:
            value = parse_float(value)
        elif field == "percent":
            value = str(value).strip()
        else:
            value = str(value).strip() if pd.notna(value) else ""
        
        order[field] = value
    
    return order
```

### –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ –∑–∞–∫–∞–∑–∞

```python
def extract_order_code(order_full: str) -> str:
    """
    –ò–∑ "–ö–ê–£–¢-001234 –æ—Ç 01.11.25 –û–û–û –ö–ª–∏–µ–Ω—Ç"
    –ò–∑–≤–ª–µ–∫–∞–µ—Ç: "–ö–ê–£–¢-001234"
    """
    import re
    
    # –ü–∞—Ç—Ç–µ—Ä–Ω—ã –Ω–æ–º–µ—Ä–æ–≤ –∑–∞–∫–∞–∑–æ–≤
    patterns = [
        r'(–ö–ê–£–¢-\d+)',
        r'(–ò–ë–£–¢-\d+)',
        r'(–¢–î–£–¢-\d+)',
    ]
    
    for pattern in patterns:
        match = re.search(pattern, order_full)
        if match:
            return match.group(1)
    
    return order_full[:20]  # Fallback
```

---

## –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏–º—ë–Ω –º–æ–Ω—Ç–∞–∂–Ω–∏–∫–æ–≤

### –ü—Ä–æ–±–ª–µ–º–∞

–ò–º–µ–Ω–∞ –≤ 1–° –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–ø–∏—Å–∞–Ω—ã –ø–æ-—Ä–∞–∑–Ω–æ–º—É:
- `–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á`
- `–ò–≤–∞–Ω–æ–≤ –ò.–ò.`
- `–ò–≤–∞–Ω–æ–≤ –ò. –ò.`
- `–ò–í–ê–ù–û–í –ò–í–ê–ù`

### –ê–ª–≥–æ—Ä–∏—Ç–º –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏

```python
def normalize_worker_name(name: str) -> str:
    """
    –ü—Ä–∏–≤–æ–¥–∏—Ç –∏–º—è –∫ –µ–¥–∏–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É: "–§–∞–º–∏–ª–∏—è –ò–º—è –û—Ç—á–µ—Å—Ç–≤–æ"
    """
    if not name:
        return ""
    
    # –£–±–∏—Ä–∞–µ–º "(–æ–ø–ª–∞—Ç–∞ –∫–ª–∏–µ–Ω—Ç–æ–º)"
    is_client = "(–æ–ø–ª–∞—Ç–∞ –∫–ª–∏–µ–Ω—Ç–æ–º)" in name.lower()
    name = re.sub(r'\s*\(–æ–ø–ª–∞—Ç–∞ –∫–ª–∏–µ–Ω—Ç–æ–º\)\s*', '', name, flags=re.IGNORECASE)
    
    # –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
    name = " ".join(name.split())
    
    # –ö–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è
    parts = name.split()
    normalized_parts = []
    
    for part in parts:
        # –†–∞—Å–∫—Ä—ã–≤–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª—ã –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ
        if len(part) <= 2 and part.endswith('.'):
            continue  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª—ã
        normalized_parts.append(part.capitalize())
    
    result = " ".join(normalized_parts)
    
    if is_client:
        result += " (–æ–ø–ª–∞—Ç–∞ –∫–ª–∏–µ–Ω—Ç–æ–º)"
    
    return result
```

### –°–ª–æ–≤–∞—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π

```python
# –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ª–æ–≤–∞—Ä—å
WORKER_NAME_MAP = {
    "–ò–≤–∞–Ω–æ–≤ –ò.–ò.": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á",
    "–ü–µ—Ç—Ä–æ–≤ –ü.": "–ü–µ—Ç—Ä–æ–≤ –ü—ë—Ç—Ä –ü–µ—Ç—Ä–æ–≤–∏—á",
    # ...
}
```

---

## –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

### –ê–ª–≥–æ—Ä–∏—Ç–º

```python
def merge_revenue_and_diagnostic(
    revenue_data: List[dict],
    diagnostic_data: List[dict]
) -> List[dict]:
    """
    –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –¥–≤—É—Ö —Ñ–∞–π–ª–æ–≤.
    
    1. –û—Å–Ω–æ–≤–∞ ‚Äî —Ñ–∞–π–ª –≤—ã—Ä—É—á–∫–∏
    2. –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫–∏ –∏–∑ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ –≤—ã—Ä—É—á–∫–µ
    3. –ü–æ–º–µ—á–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã
    """
    merged = []
    seen_keys = set()
    
    # –°–Ω–∞—á–∞–ª–∞ –≤—ã—Ä—É—á–∫–∞
    for order in revenue_data:
        key = (order["order_code"], order["worker"])
        seen_keys.add(key)
        merged.append(order)
    
    # –ü–æ—Ç–æ–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (—Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ)
    for order in diagnostic_data:
        key = (order["order_code"], order["worker"])
        if key not in seen_keys:
            merged.append(order)
    
    return merged
```

### –ö–ª—é—á —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏

```python
key = (order_code, worker_normalized)
# –ü—Ä–∏–º–µ—Ä: ("–ö–ê–£–¢-001234", "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω")
```

–û–¥–∏–Ω –∑–∞–∫–∞–∑ –º–æ–∂–µ—Ç –±—ã—Ç—å —É –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–æ–Ω—Ç–∞–∂–Ω–∏–∫–æ–≤ (—Ä–∞–±–æ—Ç–∞–ª–∏ –≤–º–µ—Å—Ç–µ).

---

## –§–∞–π–ª –Ø–Ω–¥–µ–∫—Å –ó–∞–ø—Ä–∞–≤–∫–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –§–ò–û                    ‚îÇ –°—É–º–º–∞     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á   ‚îÇ 10 000    ‚îÇ
‚îÇ –ü–µ—Ç—Ä–æ–≤ –ü—ë—Ç—Ä –ü–µ—Ç—Ä–æ–≤–∏—á   ‚îÇ 8 500     ‚îÇ
‚îÇ –°–∏–¥–æ—Ä–æ–≤ –°–∏–¥–æ—Ä          ‚îÇ 5 200     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü–∞—Ä—Å–∏–Ω–≥

```python
def parse_yandex_fuel(file: BytesIO) -> dict:
    """
    –ü–∞—Ä—Å–∏—Ç —Ñ–∞–π–ª –Ø–Ω–¥–µ–∫—Å –ó–∞–ø—Ä–∞–≤–∫–∏.
    
    Returns:
        {"–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω": 10000, "–ü–µ—Ç—Ä–æ–≤ –ü—ë—Ç—Ä": 8500, ...}
    """
    df = pd.read_excel(file)
    
    result = {}
    
    for _, row in df.iterrows():
        name = normalize_worker_name(str(row.iloc[0]))
        amount = parse_float(row.iloc[1])
        
        if name and amount > 0:
            result[name] = amount
    
    return result
```

### –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å –º–æ–Ω—Ç–∞–∂–Ω–∏–∫–∞–º–∏

```python
def match_yandex_fuel_to_workers(
    yandex_data: dict,
    workers: List[str]
) -> dict:
    """
    –°–æ–ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–º–µ–Ω–∞ –∏–∑ –Ø–Ω–¥–µ–∫—Å –ó–∞–ø—Ä–∞–≤–∫–∏ —Å –º–æ–Ω—Ç–∞–∂–Ω–∏–∫–∞–º–∏.
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç fuzzy matching –¥–ª—è –Ω–µ—Ç–æ—á–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π.
    """
    matched = {}
    
    for yandex_name, amount in yandex_data.items():
        # –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
        if yandex_name in workers:
            matched[yandex_name] = amount
            continue
        
        # –ß–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (–§–∞–º–∏–ª–∏—è –ò–º—è)
        yandex_short = " ".join(yandex_name.split()[:2])
        for worker in workers:
            worker_short = " ".join(worker.split()[:2])
            if yandex_short == worker_short:
                matched[worker] = amount
                break
    
    return matched
```

---

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

| –û—à–∏–±–∫–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|--------|---------|---------|
| –§–∞–π–ª –Ω–µ —á–∏—Ç–∞–µ—Ç—Å—è | –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ |
| –ü–µ—Ä–∏–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω | –ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç | –í–≤–µ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é |
| –ü—É—Å—Ç—ã–µ –∫–æ–ª–æ–Ω–∫–∏ | –û–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–µ —è—á–µ–π–∫–∏ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `openpyxl` |
| NaN –∑–Ω–∞—á–µ–Ω–∏—è | –ü—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ | `fillna(0)` |

### –í–∞–ª–∏–¥–∞—Ü–∏—è

```python
def validate_order(order: dict) -> List[str]:
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞.
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –æ—à–∏–±–æ–∫.
    """
    errors = []
    
    if not order.get("worker"):
        errors.append("–ù–µ —É–∫–∞–∑–∞–Ω –º–æ–Ω—Ç–∞–∂–Ω–∏–∫")
    
    if not order.get("order_code"):
        errors.append("–ù–µ —É–∫–∞–∑–∞–Ω –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞")
    
    if order.get("revenue_services", 0) < 0:
        errors.append("–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è –≤—ã—Ä—É—á–∫–∞")
    
    percent = order.get("percent", "")
    if percent and not re.match(r'\d+%?', percent):
        errors.append(f"–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ø—Ä–æ—Ü–µ–Ω—Ç–∞: {percent}")
    
    return errors
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
import logging

logger = logging.getLogger(__name__)

def parse_file_with_logging(file: UploadFile):
    logger.info(f"Parsing file: {file.filename}")
    
    try:
        df = pd.read_excel(file.file)
        logger.info(f"Loaded {len(df)} rows")
        
        file_type = detect_file_type(df)
        logger.info(f"Detected type: {file_type}")
        
        # ...
        
    except Exception as e:
        logger.error(f"Error parsing {file.filename}: {e}")
        raise
```
